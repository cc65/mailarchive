<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<title>cc65 mailing list archive: Re: [cc65] Kernel calls</title>
<meta name="Author" content="Ullrich von Bassewitz (uz_at_musoftware.de)">
<meta name="Subject" content="Re: [cc65] Kernel calls">
</head>
<body bgcolor="#FFFFFF" text="#000000">
<h1>Re: [cc65] Kernel calls</h1>
<!-- received="Fri Mar 31 21:24:46 2000" -->
<!-- isoreceived="20000331192446" -->
<!-- sent="Fri, 31 Mar 2000 21:24:28 +0200" -->
<!-- isosent="20000331192428" -->
<!-- name="Ullrich von Bassewitz" -->
<!-- email="uz_at_musoftware.de" -->
<!-- subject="Re: [cc65] Kernel calls" -->
<!-- id="20000331212428.A13965@trixie.musoftware.de" -->
<!-- inreplyto="38E50B1D.6920.113B55@localhost" -->
<!-- expires="-1" -->
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<p>
<strong>From:</strong> Ullrich von Bassewitz (<a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20Kernel%20calls"><em>uz_at_musoftware.de</em></a>)<br>
<strong>Date:</strong> 2000-03-31 21:24:28
<p>
<!-- next="start" -->
<ul>
<li><strong>Next message:</strong> <a href="../2000-04/0092.html">David Lloyd: "[cc65] Bank-switched ROMs"</a>
<li><strong>Previous message:</strong> <a href="0090.html">Martin Ancher Holm: "[cc65] Kernel calls"</a>
<li><strong>In reply to:</strong> <a href="0090.html">Martin Ancher Holm: "[cc65] Kernel calls"</a>
<!-- nextthread="start" -->
<!-- reply="end" -->
</ul>
<hr noshade><p>
<!-- body="start" -->
<pre>
On Fri, Mar 31, 2000 at 08:31:25PM +0200, Martin Ancher Holm wrote:
&gt; Over the last days, i've tried to make a macro to access kernel-calls.
&gt; I've tried to use the #define statement.
&gt;
&gt; Can't I make a simple macro like #define kernel(function, a, x, y),
&gt; instead of this for every function?

What you can do is:

--------------------------------------------------------------------------
unsigned char Y;			/* We need a temporary storage */
#define kcall(name, a, x, y)		 	   			\
    Y = y;				 	   			\
    __AX__ = ((unsigned)(x) &lt;&lt; 8) + (a); 	   			\
    asm(&quot;\tldy\t_Y&quot;);				   			\
    asm(&quot;\tjsr\t&quot; #name);
--------------------------------------------------------------------------

One problem here is, that the names of the kernal functions are unknown. You
have to define them using asm() instructions, or use the address in hex.

As an example, to output a character, use

#define	BSOUT(c)	kcall($FFD2,c,0,0)

Calling

	BSOUT('a');

Will then translate into the (inlined) code

	lda	#$00
	sta	_Y+0
	ldx	#$00
	lda	#$41
	ldy	_Y
	jsr	$FFD2

The loads and stores of y are useless in this case and can be avoided by using
a more specialized macro. The load of x cannot be avoided, because the
compiler is not smart enough.

There is also a C function called _sys (defined in 6502.h). The function is
able to call an arbitrary machine language subroutine, pass all registers and
the flags as parameters and return the register and flags after the call.
Because of the magic involved, the function is slower than using a specialized
macro to insert some lines of inline code.

Regards


	Uz


--
Ullrich von Bassewitz                                  <a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20Kernel%20calls">uz_at_musoftware.de</a>
----------------------------------------------------------------------
To unsubscribe from the list send mail to <a href="mailto:majordomo_at_musoftware.de?Subject=Re:%20[cc65]%20Kernel%20calls">majordomo_at_musoftware.de</a> with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<p><!-- body="end" -->
<hr noshade>
<ul>
<!-- next="start" -->
<li><strong>Next message:</strong> <a href="../2000-04/0092.html">David Lloyd: "[cc65] Bank-switched ROMs"</a>
<li><strong>Previous message:</strong> <a href="0090.html">Martin Ancher Holm: "[cc65] Kernel calls"</a>
<li><strong>In reply to:</strong> <a href="0090.html">Martin Ancher Holm: "[cc65] Kernel calls"</a>
<!-- nextthread="start" -->
<!-- reply="end" -->
</ul>
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<p>
<small>
<em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.3</a> 
: <em>2001-12-14 22:05:36 CET</em>
</em>
</small>
</body>
</html>
