<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<title>cc65 mailing list archive: Re: [cc65] optimizer?</title>
<meta name="Author" content="Ullrich von Bassewitz (uz_at_musoftware.de)">
<meta name="Subject" content="Re: [cc65] optimizer?">
</head>
<body bgcolor="#FFFFFF" text="#000000">
<h1>Re: [cc65] optimizer?</h1>
<!-- received="Sun Jun 24 21:08:00 2001" -->
<!-- isoreceived="20010624190800" -->
<!-- sent="Sun, 24 Jun 2001 21:08:06 +0200" -->
<!-- isosent="20010624190806" -->
<!-- name="Ullrich von Bassewitz" -->
<!-- email="uz_at_musoftware.de" -->
<!-- subject="Re: [cc65] optimizer?" -->
<!-- id="20010624210806.B32601@trixie.musoftware.de" -->
<!-- inreplyto="6321122119.20010624202011@gmx.net" -->
<!-- expires="-1" -->
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<p>
<strong>From:</strong> Ullrich von Bassewitz (<a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20optimizer?"><em>uz_at_musoftware.de</em></a>)<br>
<strong>Date:</strong> 2001-06-24 21:08:06
<p>
<!-- next="start" -->
<ul>
<li><strong>Next message:</strong> <a href="0539.html">groepaz: "Re[2]: [cc65] optimizer?"</a>
<li><strong>Previous message:</strong> <a href="0537.html">groepaz: "Re[2]: [cc65] optimizer?"</a>
<li><strong>In reply to:</strong> <a href="0537.html">groepaz: "Re[2]: [cc65] optimizer?"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="0539.html">groepaz: "Re[2]: [cc65] optimizer?"</a>
<li><strong>Reply:</strong> <a href="0539.html">groepaz: "Re[2]: [cc65] optimizer?"</a>
<!-- reply="end" -->
</ul>
<hr noshade><p>
<!-- body="start" -->
<pre>
Hi!

On Sun, Jun 24, 2001 at 08:20:11PM +0200, groepaz wrote:
&gt; well, there are several things an optimizer COULD do for handwritten
&gt; code, the simpliest beeing peephole-optimization (which in itself
&gt; again usually isnt necessary unless the assembler code was written by
&gt; a _bad_ assembler coder ;=), with the exception of unrolled code
&gt; generated by assembler loops). this is the only thing the optimizer i
&gt; am currently using (derivated from the one daniel dallman published on
&gt; his lunix pages) can do to be honest. it is useful for quickly
&gt; checking the quality of old source-codes in the first place (if you
&gt; see &quot;;removed&quot; a lot, the code probably sux ;D), and sometimes very
&gt; handy for writing optimized unrolled code.

I found the idea behind this peephole optimizer interesting and I've done some
tests with Daniels sources. However, any of my source files went through this
program unchanged.

&gt; - replacing sequences of &quot;legal&quot; 65x opcodes by &quot;illegal&quot; nmos6510
&gt; opcodes (that would be pretty much a c64 specific optimization stage
&gt; primarily useful for demos only)

This sounds nice, but improvements are probably limited. I haven't tried
illegal opcodes for now, but my experiences with 65C02 code are somewhat
disapointing. Improvements (both speed and size) are somewhere in the range of
one percent or lower and portability is a problem. I would assume that the
advantages of using illegal opcodes (which are often not very useful) are even
lower.

[...]

It would be nice to see how these proposed changes affect existing code. As
said above, I've tried Daniels code and it had no effect on my sources
whatsoever. Some of your proposed additions are also dangerous, since they may
defeat knowledge, the programmer has put into the code (maybe in this special
section of code, VALUE is zero more often than not zero?), so they should be
switcheable.

If you really get something like this running I would be interested in some
results. There is one file in the cc65 C library (the free() function in
free.s) where I know that a few instructions can be removed by clever
rewriting/rearranging. I've avoided to do that, because the module is quite
complex and the changes would obfuscate the code even more. If your optimizer
manages to actually fix these locations, I would assume it's pretty good.

Another idea would be to let such an optimizer work on binary code. There are
some additional problems (optimizations of hardware accesses are dangerous,
and code addresses loaded as 8 bit values into registers must be detected and
handled), but other problems (like handling complex expressions) would vanish
completely.

Regards


        Uz


--
Ullrich von Bassewitz                                  <a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20optimizer?">uz_at_musoftware.de</a>
----------------------------------------------------------------------
To unsubscribe from the list send mail to <a href="mailto:majordomo_at_musoftware.de?Subject=Re:%20[cc65]%20optimizer?">majordomo_at_musoftware.de</a> with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<p><!-- body="end" -->
<hr noshade>
<ul>
<!-- next="start" -->
<li><strong>Next message:</strong> <a href="0539.html">groepaz: "Re[2]: [cc65] optimizer?"</a>
<li><strong>Previous message:</strong> <a href="0537.html">groepaz: "Re[2]: [cc65] optimizer?"</a>
<li><strong>In reply to:</strong> <a href="0537.html">groepaz: "Re[2]: [cc65] optimizer?"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="0539.html">groepaz: "Re[2]: [cc65] optimizer?"</a>
<li><strong>Reply:</strong> <a href="0539.html">groepaz: "Re[2]: [cc65] optimizer?"</a>
<!-- reply="end" -->
</ul>
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<p>
<small>
<em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.3</a> 
: <em>2001-12-14 22:05:40 CET</em>
</em>
</small>
</body>
</html>
