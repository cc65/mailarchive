<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<title>cc65 mailing list archive: Re: [cc65] Atari file i/o more info</title>
<meta name="Author" content="Shawn Jefferson (sjefferson_at_sd62.bc.ca)">
<meta name="Subject" content="Re: [cc65] Atari file i/o more info">
</head>
<body bgcolor="#FFFFFF" text="#000000">
<h1>Re: [cc65] Atari file i/o more info</h1>
<!-- received="Fri May 31 19:02:10 2002" -->
<!-- isoreceived="20020531170210" -->
<!-- sent="Fri, 31 May 2002 10:01:54 -0700" -->
<!-- isosent="20020531170154" -->
<!-- name="Shawn Jefferson" -->
<!-- email="sjefferson_at_sd62.bc.ca" -->
<!-- subject="Re: [cc65] Atari file i/o more info" -->
<!-- id="scf74a21.030@gwmail.sd62.bc.ca" -->
<!-- inreplyto="[cc65] Atari file i/o more info" -->
<!-- expires="-1" -->
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<p>
<strong>From:</strong> Shawn Jefferson (<a href="mailto:sjefferson_at_sd62.bc.ca?Subject=Re:%20[cc65]%20Atari%20file%20i/o%20more%20info"><em>sjefferson_at_sd62.bc.ca</em></a>)<br>
<strong>Date:</strong> 2002-05-31 19:01:54
<p>
<!-- next="start" -->
<ul>
<li><strong>Previous message:</strong> <a href="1423.html">Christian Groessler: "Re: [cc65] Atari file i/o more info"</a>
<li><strong>Maybe in reply to:</strong> <a href="1314.html">Shawn Jefferson: "[cc65] Atari file i/o more info"</a>
<!-- nextthread="start" -->
<!-- reply="end" -->
</ul>
<hr noshade><p>
<!-- body="start" -->
<pre>
Hi Chris,

&gt;<a href="ftp://ftp.aladdin.de/pub/people/chris/cc65/shawn.zip">ftp://ftp.aladdin.de/pub/people/chris/cc65/shawn.zip</a> 
&gt;
&gt;&gt;
&gt;&gt; Did you look into the append mode for opening a file?
&gt;
&gt;I've implemented support for fopen(..,&quot;a&quot;). But it's not tested yet
&gt;by me. It's already included in above zip. I don't see a way to
&gt;support &quot;a+&quot;, since AtariDOS insists on write-only if the append bit
&gt;is set.

I've tested with this new atari.lib and here's what I found:

AtariDOS
  append mode: works!
  fopen(r+), fseek(end), write: doesn't work, fseek not implemented in AtariDOS
  fopen(r+), read to feof, write: doesn't work, limitation of AtariDOS(?)
  fopen(r+), fseek(set+4), write: doesn't work, fseek not implemented in AtariDOS
  
All this works as I was expecting it to, except that when you open a file in r+ mode, read to the end of the file and write some bytes, fwrite returns the number of bytes that you wanted to write, even though no bytes get written since AtariDOS doesn't allow writing past the end of the file in r/w mode.

SpartaDOS
  append mode: works!
  fopen(r+), fseek(end), write: works!
  fopen(r+), read to feof, write: doesn't work, never finds EOF, limitation of SpartaDOS(?)
  fopen(r+), fseek(set+4), write: works!

I wonder is there is some way to get SpartaDOS to signal an EOF that we can detect?  If we design a routine to read records until feof (which is pretty common) it simply won't work in r/w mode in Sparta.  Not a huge problem since we can get around it by reading in read mode, and then switching to another mode for writing.  ftell would be nice for that, is it implemented?  Didn't seem to be when I tested it.

Great work, Chris!  The C64 guys have to be really jealous now. ;)



----------------------------------------------------------------------
To unsubscribe from the list send mail to <a href="mailto:majordomo_at_musoftware.de?Subject=Re:%20[cc65]%20Atari%20file%20i/o%20more%20info">majordomo_at_musoftware.de</a> with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<p><!-- body="end" -->
<hr noshade>
<ul>
<!-- next="start" -->
<li><strong>Previous message:</strong> <a href="1423.html">Christian Groessler: "Re: [cc65] Atari file i/o more info"</a>
<li><strong>Maybe in reply to:</strong> <a href="1314.html">Shawn Jefferson: "[cc65] Atari file i/o more info"</a>
<!-- nextthread="start" -->
<!-- reply="end" -->
</ul>
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<p>
<small>
<em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.3</a> 
: <em>2002-05-31 19:03:03 CEST</em>
</em>
</small>
</body>
</html>
