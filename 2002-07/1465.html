<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<title>cc65 mailing list archive: [cc65] Bug Hunting Odysee</title>
<meta name="Author" content="groepaz (groepaz_at_gmx.net)">
<meta name="Subject" content="[cc65] Bug Hunting Odysee">
</head>
<body bgcolor="#FFFFFF" text="#000000">
<h1>[cc65] Bug Hunting Odysee</h1>
<!-- received="Thu Jul 11 20:51:17 2002" -->
<!-- isoreceived="20020711185117" -->
<!-- sent="Thu, 11 Jul 2002 20:51:05 +0200" -->
<!-- isosent="20020711185105" -->
<!-- name="groepaz" -->
<!-- email="groepaz_at_gmx.net" -->
<!-- subject="[cc65] Bug Hunting Odysee" -->
<!-- id="9125177491.20020711205105@gmx.net" -->
<!-- inreplyto="20020711084351.GA20032@trixie.musoftware.de" -->
<!-- expires="-1" -->
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<p>
<strong>From:</strong> groepaz (<a href="mailto:groepaz_at_gmx.net?Subject=Re:%20[cc65]%20Bug%20Hunting%20Odysee"><em>groepaz_at_gmx.net</em></a>)<br>
<strong>Date:</strong> 2002-07-11 20:51:05
<p>
<!-- next="start" -->
<ul>
<li><strong>Previous message:</strong> <a href="1464.html">Ullrich von Bassewitz: "Re: [cc65] Graphics library"</a>
<li><strong>In reply to:</strong> <a href="1464.html">Ullrich von Bassewitz: "Re: [cc65] Graphics library"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="1466.html">Ullrich von Bassewitz: "Re: [cc65] Bug Hunting Odysee"</a>
<li><strong>Reply:</strong> <a href="1466.html">Ullrich von Bassewitz: "Re: [cc65] Bug Hunting Odysee"</a>
<!-- reply="end" -->
</ul>
<hr noshade><p>
<!-- body="start" -->
<pre>
Hello Ullrich,

UvB&gt; My usual advice for Windows users when strange things start to happen is:
UvB&gt; Format the hard disk and do a complete reinstall. This helps in many cases.

eh :=P well honest, no ;) there are a dozen compilers running just
fine on this machine and i cant really believe it should be windoze by
itself that fucks things up.

however....

1) installed cc65 cleanly on another win98 box
2) copied over my c64 dev environment
3) compiled array.c using my dev-environment
   - DONT work... as before
4) compiled array.c using &quot;cl65 array.c -o array.prg&quot;
   - THIS WORKS!!! (/me scratching head ;=P)
   conclusion: bug is indeed located inside my environment, starting
   to track this down...
5) moving back to the first win98 box, compiling &quot;array.c&quot; using
   cl65... this ALSO works ... err ;=P
6) compiling by launching utils manually....
   cc65 array.c -o array.s
   ca65 array.s -o array.o
   ld65 c64.o array.o c64.lib -o array.prg -t c64
   ... and the resulting binary does _NOT_ work anymore!!!

   new conclusion: bug aint related to my dev-environment in
   particular, but probably to calling tools manually and not through
   cl65... (i feel much better now ;=P lol)
   
7) comparing both binaries shows some differences (first is working
   binary)
   00000D98: 44 64  -&gt; should be 'd'
   00000D9A: 0D 0A  -&gt; should be '\n'
   00000D9E: 44 64
   00000DA0: 0D 0A
   00000DA4: 44 64
   00000DA6: 0D 0A
   00000DAA: 44 64
   00000DAC: 0D 0A

   the (wrong) data in question is infact constant character-strings
   quoted in printf's ...

   investigating further...
   
8) TADA.... this solves it :o)

   cc65 array.c -o array.s -t c64
   ca65 array.s -o array.o
   ld65 c64.o array.o c64.lib -o array.prg -t c64

   (strange, i _DID_ supply -t c64 to cc65 in my dev-environment
   before ...eh ;=P)

   my guess is that infact the added support for different
   character-translation-tables broke something that worked before (?)
   ...

9) trying with optimizations.... huhuhu, troubles again ;=P

   cl65 array.c -o array.prg -O

   ... and

   cc65 array.c -o array.s -t c64 -O
   ca65 array.s -o array.o
   ld65 c64.o array.o c64.lib -o array.prg -t c64

   now BOTH binaries work, but strange enough the second binary is
   shorter than the first one....

   cl65 -S array.c -o array.s -O
   cc65 array.c -o array.s -t c64 -O

   ...comparing the generated asm files proves the differences, which
   are (my guess ;=)) optimizations NOT contained in the binary
   generated by cl65 !

   now it really becomes interisting.... new guess is that cl65 doesnt
   pass optimization flags correctly (or atleast differently?) as
   expected....

   YES... a quick hack inside cl65 proves it.... it doesnt pass -O
   flags at ALL !!!

   PHEW... and the solution is so easy, just never put any switches
   after filenames .. doh :~] this has probably caused other problems
   before aswell, argls ;/

10)
   pah....
   
   cl65 -o array1.prg -Oirs array.c

   cc65 -o array2.s -t c64 -Oirs array.c
   ca65 -o array2.o array2.s
   ld65 -o array2.prg -t c64 c64.o array2.o c64.lib
   
   these do now produce identical, but yet _NON_ working binaries ;=P
   (/me slowly getting mad ;=D)

   ok now more hunting....

   works: -O -Os -Or -Ors
   dont work: -Oi -Oirs -Osi -Ori

   looks like -Oi is fux0red eh? :=P

11)
   ok, so now this should have really been it.... i changed all my
   environment to always put filenames last on the command line and i
   use -Ors now..... looks like this fixes most of the problems i had,
   cheers :o)

however...
   that unpredictable behaviour related to the order of files and
   switches on the commandline baffles me ;=P IMHO the order either
   shouldnt matter at all (preferred ofcoz) OR the respective tool
   should abort with an error message.... just silently ignoring those
   switches is BAD BAAAAD style. really UUUUGLY ;=D hehehe (just
   kidding ;=))

ok, for the -Oi bug its your turn now i guess :o) i am trying to clean
up my stuff now and make it work with all your recent changes (that
module stuff might actually make the filesystem useful ;=P)....
hopefully the testsuite will allow you to find some more subtle
problems then aswell :o) (i have found some more notes on problems i
had with 2.7.1 ...gotta recheck this stuff aswell :=P)

ohwell...this got longer than i thought uh, gotta stop it :P

-- 
Best regards,
 groepaz                            mailto:<a href="mailto:groepaz_at_gmx.net?Subject=Re:%20[cc65]%20Bug%20Hunting%20Odysee">groepaz_at_gmx.net</a>

ps: some other little flaws i noticed when tracking this down....

1) in cl65 cmdline-help is a typo.... it should be &quot;compile and
   assemble&quot; not &quot;Compiler ...&quot; :=D

2) there should be an easy way to let cl65 print the commandline it
uses to call sub-processes. would have saved me some time atleast i
guess :o) (i quickly hacked it to do that actually ;=P)


----------------------------------------------------------------------
To unsubscribe from the list send mail to <a href="mailto:majordomo_at_musoftware.de?Subject=Re:%20[cc65]%20Bug%20Hunting%20Odysee">majordomo_at_musoftware.de</a> with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<p><!-- body="end" -->
<hr noshade>
<ul>
<!-- next="start" -->
<li><strong>Previous message:</strong> <a href="1464.html">Ullrich von Bassewitz: "Re: [cc65] Graphics library"</a>
<li><strong>In reply to:</strong> <a href="1464.html">Ullrich von Bassewitz: "Re: [cc65] Graphics library"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="1466.html">Ullrich von Bassewitz: "Re: [cc65] Bug Hunting Odysee"</a>
<li><strong>Reply:</strong> <a href="1466.html">Ullrich von Bassewitz: "Re: [cc65] Bug Hunting Odysee"</a>
<!-- reply="end" -->
</ul>
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<p>
<small>
<em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.3</a> 
: <em>2002-07-11 20:52:26 CEST</em>
</em>
</small>
</body>
</html>
