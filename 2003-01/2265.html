<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<title>cc65 mailing list archive: Re: [cc65] #include</title>
<meta name="Author" content="Ullrich von Bassewitz (uz_at_musoftware.de)">
<meta name="Subject" content="Re: [cc65] #include">
</head>
<body bgcolor="#FFFFFF" text="#000000">
<h1>Re: [cc65] #include</h1>
<!-- received="Thu Jan  9 22:52:58 2003" -->
<!-- isoreceived="20030109215258" -->
<!-- sent="Thu, 9 Jan 2003 22:52:56 +0100" -->
<!-- isosent="20030109215256" -->
<!-- name="Ullrich von Bassewitz" -->
<!-- email="uz_at_musoftware.de" -->
<!-- subject="Re: [cc65] #include" -->
<!-- id="20030109215256.GC5367@trixie.musoftware.de" -->
<!-- inreplyto="000d01c2b81e$7a51b520$6500a8c0@briandvwzriudd" -->
<!-- expires="-1" -->
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<p>
<strong>From:</strong> Ullrich von Bassewitz (<a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20#include"><em>uz_at_musoftware.de</em></a>)<br>
<strong>Date:</strong> 2003-01-09 22:52:56
<p>
<!-- next="start" -->
<ul>
<li><strong>Previous message:</strong> <a href="2264.html">Ullrich von Bassewitz: "Re: [cc65] 6502.h"</a>
<li><strong>In reply to:</strong> <a href="2261.html">Brian Bagnall: "[cc65] #include"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="2266.html">Spiro Trikaliotis: "Re: [cc65] #include"</a>
<!-- reply="end" -->
</ul>
<hr noshade><p>
<!-- body="start" -->
<pre>
Hi!

On Thu, Jan 09, 2003 at 02:34:15PM -0600, Brian Bagnall wrote:
&gt; Forgive the newby question, but I'm having problems using include with a
&gt; ridiculously basic object file I made. This example should call a method
&gt; from a separate file. The main file is this:
&gt;
&gt; #include &lt;stdio.h&gt;
&gt; #include &quot;ia.h&quot;
&gt;
&gt; int main(void)
&gt; {
&gt;  int x;
&gt;  x = getnumber();
&gt;  printf(&quot;The number is %i&quot;,x);
&gt; }
&gt;
&gt; ia.h looks like this:
&gt;
&gt; extern int getnumber(void);
&gt;
&gt; ia.c looks like this:
&gt;
&gt; int getnumber(void)
&gt; {
&gt;  return 45;
&gt; }
&gt;
&gt; Here's the steps I went through to build an executable:
&gt; 1. cc65 on ia.c to produce ia.s
&gt; 2. ca65 on ia.s to produce ia.o
&gt; 3. saved ia.h in same directory as the rest
&gt; 4. compiles main.h with cl65.

In step 4., you have to specify io.o so the linker can bind it to the
executable. Even easier, you can combine steps 1-4 into one:

        cl65 main.c ia.c

This will compile main.c into main.o, ia.c into ia.o and then link both
together creating an executable that has the same base name as the first file
(main in this case).

You seem to be confusing the linker step, and &quot;#incuding&quot; a header file. Using
#include means that the directive is replaced by the contents of the specified
file. Include files usually contain declarations like:

        extern int getnumber(void);

This differs from a definition:

        int getnumber(void)
        {
         return 45;
        }

A declaration just tells the compiler: There is an object with that name
somewhere. In case of a function, it enables the compiler to check the
parameter list, generate a subroutine call for the function, and mark the
function as &quot;extern&quot; in the assembler file, so an import is generated by the
object file. It is the job of the linker in a later step to search for another
object file that exports getnumber and resolve the jsr call to actually jump
to this location.

So in your case: When compiling main.c, the compiler will include ia.h, in
which the getnumber() function is declared. But since the compiler does not
see ia.c (where the function is defined), it cannot generate code for this
function, so it inserts a jsr to this function and marks this jsr so the
linker can later fill in the correct address for getnumber. To do that, the
linker needs all object files, otherwise it doesn't know the address of
getnumber.

&gt; Unresolved external `_getnumber' referenced in:
&gt;   C:\Projects\Play\hist.s(11)
                     ^^^^^^

This seems to be a third file?!?

Regards


        Uz


-- 
Ullrich von Bassewitz                                  <a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20#include">uz_at_musoftware.de</a>
----------------------------------------------------------------------
To unsubscribe from the list send mail to <a href="mailto:majordomo_at_musoftware.de?Subject=Re:%20[cc65]%20#include">majordomo_at_musoftware.de</a> with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<p><!-- body="end" -->
<hr noshade>
<ul>
<!-- next="start" -->
<li><strong>Previous message:</strong> <a href="2264.html">Ullrich von Bassewitz: "Re: [cc65] 6502.h"</a>
<li><strong>In reply to:</strong> <a href="2261.html">Brian Bagnall: "[cc65] #include"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="2266.html">Spiro Trikaliotis: "Re: [cc65] #include"</a>
<!-- reply="end" -->
</ul>
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<p>
<small>
<em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.3</a> 
: <em>2003-01-09 22:53:03 CET</em>
</em>
</small>
</body>
</html>
