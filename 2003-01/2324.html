<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<title>cc65 mailing list archive: Re: [cc65] register vars</title>
<meta name="Author" content="Ullrich von Bassewitz (uz_at_musoftware.de)">
<meta name="Subject" content="Re: [cc65] register vars">
</head>
<body bgcolor="#FFFFFF" text="#000000">
<h1>Re: [cc65] register vars</h1>
<!-- received="Mon Jan 20 07:16:55 2003" -->
<!-- isoreceived="20030120061655" -->
<!-- sent="Mon, 20 Jan 2003 07:16:53 +0100" -->
<!-- isosent="20030120061653" -->
<!-- name="Ullrich von Bassewitz" -->
<!-- email="uz_at_musoftware.de" -->
<!-- subject="Re: [cc65] register vars" -->
<!-- id="20030120061653.GA13556@trixie.musoftware.de" -->
<!-- inreplyto="200301180121.h0I1L7lk012895@xcip5.studcs.uni-sb.de" -->
<!-- expires="-1" -->
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<p>
<strong>From:</strong> Ullrich von Bassewitz (<a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20register%20vars"><em>uz_at_musoftware.de</em></a>)<br>
<strong>Date:</strong> 2003-01-20 07:16:53
<p>
<!-- next="start" -->
<ul>
<li><strong>Previous message:</strong> <a href="2323.html">Ullrich von Bassewitz: "Re: [cc65] &quot;none&quot; target (was: LUnix)"</a>
<li><strong>In reply to:</strong> <a href="2313.html">Stephan Lesch: "[cc65] register vars"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="2355.html">Ullrich von Bassewitz: "Re: [cc65] register vars"</a>
<!-- reply="end" -->
</ul>
<hr noshade><p>
<!-- body="start" -->
<pre>
Good morning!

Sorry for the delay, I'm still very busy with my new flat, so please bear with
me.

On Sat, Jan 18, 2003 at 02:21:07AM +0100, Stephan Lesch wrote:
&gt; is there a way to use statically-declared register variables?

There are some ways, but using the &quot;register&quot; keyword is none of them. The
compiler accepts the &quot;register&quot; keyword for globals (as well as &quot;auto&quot;), but
this is an error in the compiler - it should issue an error message, but does
not. The problem is fixed, see the &quot;Known Bugs&quot; page.

Using static zero page locations:

  1. Use numeric addresses and hide them behind a define:

        #define XPos (*(unsigned char*)0xFC)
        ...
        XPos = 3;

  2. Declare the variables in an assembler module, export them using
     &quot;.exportzp&quot;, and tell the compiler using the &quot;#pragma zpsym&quot; statement:

        ------------------foo.s---------------
        .exportzp       _XPos
        .zeropage
        _XPos:  .res    1
        --------------------------------------

        ------------------bar.c---------------
        extern unsigned char XPos;
        #pragma zpsym (&quot;XPos&quot;)
        XPos = 3;
        --------------------------------------

     You may have to change the linker config when using this method, because
     the standard zeropage segment does not have any space left, so the
     variable declared in foo.s will generate a segment overflow.

Note that all this is not portable, neither to other C compilers, nor between
the supported machines (because of the zero page address used).

&gt; I tried it with V 2.9.0, but the register vars declared on top level are
&gt; mapped to the same zp location:

This is because the compiler should not accept the declaration in the first
place.

Regards


        Uz


-- 
Ullrich von Bassewitz                                  <a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20register%20vars">uz_at_musoftware.de</a>
----------------------------------------------------------------------
To unsubscribe from the list send mail to <a href="mailto:majordomo_at_musoftware.de?Subject=Re:%20[cc65]%20register%20vars">majordomo_at_musoftware.de</a> with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<p><!-- body="end" -->
<hr noshade>
<ul>
<!-- next="start" -->
<li><strong>Previous message:</strong> <a href="2323.html">Ullrich von Bassewitz: "Re: [cc65] &quot;none&quot; target (was: LUnix)"</a>
<li><strong>In reply to:</strong> <a href="2313.html">Stephan Lesch: "[cc65] register vars"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="2355.html">Ullrich von Bassewitz: "Re: [cc65] register vars"</a>
<!-- reply="end" -->
</ul>
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<p>
<small>
<em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.3</a> 
: <em>2003-01-20 07:17:22 CET</em>
</em>
</small>
</body>
</html>
