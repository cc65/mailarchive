<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-7">
<title>cc65 mailing list archive: [cc65] mallocing an aligned buffer</title>
<meta name="Author" content="Shawn Jefferson (sjefferson_at_sd62.bc.ca)">
<meta name="Subject" content="[cc65] mallocing an aligned buffer">
</head>
<body bgcolor="#FFFFFF" text="#000000">
<h1>[cc65] mallocing an aligned buffer</h1>
<!-- received="Thu Jan 23 00:50:51 2003" -->
<!-- isoreceived="20030122235051" -->
<!-- sent="Wed, 22 Jan 2003 15:50:34 -0800" -->
<!-- isosent="20030122235034" -->
<!-- name="Shawn Jefferson" -->
<!-- email="sjefferson_at_sd62.bc.ca" -->
<!-- subject="[cc65] mallocing an aligned buffer" -->
<!-- id="se2ebdd2.044@gwmail.sd62.bc.ca" -->
<!-- charset="ISO-8859-7" -->
<!-- expires="-1" -->
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<p>
<strong>From:</strong> Shawn Jefferson (<a href="mailto:sjefferson_at_sd62.bc.ca?Subject=Re:%20[cc65]%20mallocing%20an%20aligned%20buffer"><em>sjefferson_at_sd62.bc.ca</em></a>)<br>
<strong>Date:</strong> 2003-01-23 00:50:34
<p>
<!-- next="start" -->
<ul>
<li><strong>Previous message:</strong> <a href="2330.html">Christian Krüger: "[cc65] Another wish: Unsized Arrays in Structures"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="2354.html">Ullrich von Bassewitz: "Re: [cc65] mallocing an aligned buffer"</a>
<li><strong>Reply:</strong> <a href="2354.html">Ullrich von Bassewitz: "Re: [cc65] mallocing an aligned buffer"</a>
<!-- reply="end" -->
</ul>
<hr noshade><p>
<!-- body="start" -->
<pre>
I got some help mallocing a 4k aligned buffer some time back and this works great.  I now have another problem that I wonder if someone could help me solve.

Due to limitations of the hardware in the Atari computer, the ANTIC chip can only address via DMA a 4k buffer.  With some modes you need to reload the DMA address base register (LMS) to get antic over its 4k address wall.  So the problem then becomes if I want to create an 7680 byte buffer it cannot be aligned on a 4k boundary since when ANTIC gets to the end of the 4k chunk it ends up being in the middle of the screen.  Each screen line being 40 bytes in length. 4096 / 40 = 102.4  You can see that at the 102nd line ANTIC cannot continue loading data properly since its address offset counter &quot;rolls over&quot; back to 0.

What I need is an algorithim that will malloc a buffer that takes these contraints into account.  I need the END of the buffer to line up with the 4k boundary, not the START. Ideally it would put 4080 bytes before the 4k boundary and 3600 bytes after, but it could really be setup in any way that makes sure a screen line ends on the 4k boundary and the next screen &quot;chunk&quot; doesn't cross the next 4k boundary.  I'm trying to implement something that is fairly generic and can alloc various size buffers but always deals with the 4k boundary properly.

Sheesh, did that make sense?  I hope so.

¯
Shawn Jefferson



----------------------------------------------------------------------
To unsubscribe from the list send mail to <a href="mailto:majordomo_at_musoftware.de?Subject=Re:%20[cc65]%20mallocing%20an%20aligned%20buffer">majordomo_at_musoftware.de</a> with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<p><!-- body="end" -->
<hr noshade>
<ul>
<!-- next="start" -->
<li><strong>Previous message:</strong> <a href="2330.html">Christian Krüger: "[cc65] Another wish: Unsized Arrays in Structures"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="2354.html">Ullrich von Bassewitz: "Re: [cc65] mallocing an aligned buffer"</a>
<li><strong>Reply:</strong> <a href="2354.html">Ullrich von Bassewitz: "Re: [cc65] mallocing an aligned buffer"</a>
<!-- reply="end" -->
</ul>
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<p>
<small>
<em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.3</a> 
: <em>2003-01-23 00:51:02 CET</em>
</em>
</small>
</body>
</html>
