<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<title>cc65 mailing list archive: Re: [cc65] How to count free memory</title>
<meta name="Author" content="Ullrich von Bassewitz (uz_at_musoftware.de)">
<meta name="Subject" content="Re: [cc65] How to count free memory">
</head>
<body bgcolor="#FFFFFF" text="#000000">
<h1>Re: [cc65] How to count free memory</h1>
<!-- received="Sat Feb  1 11:08:28 2003" -->
<!-- isoreceived="20030201100828" -->
<!-- sent="Sat, 1 Feb 2003 11:08:26 +0100" -->
<!-- isosent="20030201100826" -->
<!-- name="Ullrich von Bassewitz" -->
<!-- email="uz_at_musoftware.de" -->
<!-- subject="Re: [cc65] How to count free memory" -->
<!-- id="20030201100826.GB30946@trixie.musoftware.de" -->
<!-- inreplyto="3E3B8A07.73284EDD@web.de" -->
<!-- expires="-1" -->
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<p>
<strong>From:</strong> Ullrich von Bassewitz (<a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20How%20to%20count%20free%20memory"><em>uz_at_musoftware.de</em></a>)<br>
<strong>Date:</strong> 2003-02-01 11:08:26
<p>
<!-- next="start" -->
<ul>
<li><strong>Previous message:</strong> <a href="2375.html">Ullrich von Bassewitz: "Re: [cc65] loadpaintmagic"</a>
<li><strong>In reply to:</strong> <a href="2373.html">Tim Schürmann: "[cc65] How to count free memory"</a>
<!-- nextthread="start" -->
<!-- reply="end" -->
</ul>
<hr noshade><p>
<!-- body="start" -->
<pre>
Hi!

On Sat, Feb 01, 2003 at 09:49:11AM +0100, Tim Schürmann wrote:
&gt; Another stupid question about the memory:

There are stupid questions, but yours is definitely not one of them:-)

&gt; In my program i'm doing some wild &quot;malloc&quot; and &quot;free&quot;-actions (please,
&gt; don't ask why ;)). Now i want to show the user at runtime(!) how many
&gt; memory (in byte) he could actually use.
&gt;
&gt; The best solution seems to be a C-Funktion, which will return the free
&gt; bytes as an unsigned int.

The problem with this approach is that you can have kilobytes of memory free,
without having a single byte that can be used by the program. This happens
when the heap gets heavily fragmented. If there are several hundred blocks
with less than 32 bytes available, your program won't be able to allocate one
block with 32 byte, even if such a function returns free space.

Anyway, since such a function can be useful sometimes, here is an
implementation. I will add this and a few more heap utility functions to the
development version.

    #include &quot;../libsrc/common/_heap.h&quot;

    unsigned heapfree (void)
    {
        /* Walk the free list */
        unsigned Size = 0;
        register struct freeblock* F = _hfirst;
        while (F) {
            Size += F-&gt;size;
            F = F-&gt;next;
        }

        /* Add the big chunk at _hptr */
        Size += (_hend - _hptr) * sizeof (*_hend);

        /* Done */
        return Size;
    }

Please note that you need the _heap.h header file from the source distribution
to compile this code. And, since you're accessing implementation details, the
code may not work with future versions of the library. To avoid these
problems, I will add this and a few more heap utility functions to the
development version, so they should be in the next release.

Regards


        Uz


-- 
Ullrich von Bassewitz                                  <a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20How%20to%20count%20free%20memory">uz_at_musoftware.de</a>
----------------------------------------------------------------------
To unsubscribe from the list send mail to <a href="mailto:majordomo_at_musoftware.de?Subject=Re:%20[cc65]%20How%20to%20count%20free%20memory">majordomo_at_musoftware.de</a> with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<p><!-- body="end" -->
<hr noshade>
<ul>
<!-- next="start" -->
<li><strong>Previous message:</strong> <a href="2375.html">Ullrich von Bassewitz: "Re: [cc65] loadpaintmagic"</a>
<li><strong>In reply to:</strong> <a href="2373.html">Tim Schürmann: "[cc65] How to count free memory"</a>
<!-- nextthread="start" -->
<!-- reply="end" -->
</ul>
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<p>
<small>
<em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.3</a> 
: <em>2003-02-01 11:09:01 CET</em>
</em>
</small>
</body>
</html>
