<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<title>cc65 mailing list archive: Re: [cc65] Strange problem</title>
<meta name="Author" content="Ullrich von Bassewitz (uz_at_musoftware.de)">
<meta name="Subject" content="Re: [cc65] Strange problem">
</head>
<body bgcolor="#FFFFFF" text="#000000">
<h1>Re: [cc65] Strange problem</h1>
<!-- received="Thu Feb  6 10:46:02 2003" -->
<!-- isoreceived="20030206094602" -->
<!-- sent="Thu, 6 Feb 2003 10:46:00 +0100" -->
<!-- isosent="20030206094600" -->
<!-- name="Ullrich von Bassewitz" -->
<!-- email="uz_at_musoftware.de" -->
<!-- subject="Re: [cc65] Strange problem" -->
<!-- id="20030206094600.GB17658@trixie.musoftware.de" -->
<!-- inreplyto="se4137a1.095@gwmail.sd62.bc.ca" -->
<!-- expires="-1" -->
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<p>
<strong>From:</strong> Ullrich von Bassewitz (<a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20Strange%20problem"><em>uz_at_musoftware.de</em></a>)<br>
<strong>Date:</strong> 2003-02-06 10:46:00
<p>
<!-- next="start" -->
<ul>
<li><strong>Previous message:</strong> <a href="2418.html">Christian Kruger: "Re: [cc65] Strange problem"</a>
<li><strong>In reply to:</strong> <a href="2417.html">Shawn Jefferson: "[cc65] Strange problem"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="2420.html">Shawn Jefferson: "Re: [cc65] Strange problem"</a>
<li><strong>Next in thread:</strong> <a href="../2002-07/1504.html">cbmnut_at_hushmail.com: "Re: Re: [cc65] Strange problem"</a>
<li><strong>Maybe reply:</strong> <a href="../2002-07/1504.html">cbmnut_at_hushmail.com: "Re: Re: [cc65] Strange problem"</a>
<li><strong>Maybe reply:</strong> <a href="../2002-07/1506.html">Shawn Jefferson: "Re: Re: [cc65] Strange problem"</a>
<!-- reply="end" -->
</ul>
<hr noshade><p>
<!-- body="start" -->
<pre>
Hi!

On Wed, Feb 05, 2003 at 04:10:33PM -0800, Shawn Jefferson wrote:
&gt; Am I correct in saying that local variables are put on the stack?

In most cases yes. Exceptions:

  * Local variables declared as static do not go onto the stack.

  * Using the --static-locals compiler switch will cause the compiler to
    place local variables in static storage.

  * Variables declared as &quot;register&quot; do not go onto the stack if register
    variables are enabled and there's enough free space left in the register
    bank.

&gt; It
&gt; appears that for some reason cc65 is grabbing a value from the stack
&gt; incorrectly for some computations.  The weird thing is that if I take this out
&gt; of my program and put into a small test file it works!

Code generated for a specific function is independent of the other functions
in this module (that is, cc65 does no global optimizations). So if you move a
complete function into a separate module and include the same header files,
the same code will be generated.

&gt; Would there be any case where the compiler would grab stuff from the stack
&gt; beyond the local variables?

Apart from local variables, there are some other objects stored onto the
stack:

  * Parameters passed to the executing function.

  * Parameters passed to called functions.

  * Intermediate results for expressions or values passed to runtime helper
    functions.

  * The old contents of the register bank if the function utilizes register
    variables.

Have you tried using the debugger module instead of the builtin debugger of
your emulator? The debugger module runs on the 6502 machine, so it's more
limited in some areas than an emulator. However, since it knows about some
cc65 internals, and it has a nice fullscreen view, it can often display more
useful information. I have to admit that I prefer using the debugger module
over the debugger built into VICE, provided that none of the limitations come
into effect.

To use the debugger module, include &lt;dbg.h&gt;, and call the initialization code
at program start:

        DbgInit (0);

Then, compile one or more breakpoints into the code using the BREAK() macro.
If the program reaches a breakpoint, the debugger screen will pop up
(destroying your program output). Among other things, it displays both stacks,
the parameter and the CPU stack (&quot;CS&quot; denotes the current C stack pointer).
Please note that you will have to use &quot;s&quot; to skip the BRK instruction
generated by the BREAK macro before you can single step through your code.

Don't know if this helps, but it's probably worth a try.

Regards


        Uz


-- 
Ullrich von Bassewitz                                  <a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20Strange%20problem">uz_at_musoftware.de</a>
----------------------------------------------------------------------
To unsubscribe from the list send mail to <a href="mailto:majordomo_at_musoftware.de?Subject=Re:%20[cc65]%20Strange%20problem">majordomo_at_musoftware.de</a> with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<p><!-- body="end" -->
<hr noshade>
<ul>
<!-- next="start" -->
<li><strong>Previous message:</strong> <a href="2418.html">Christian Kruger: "Re: [cc65] Strange problem"</a>
<li><strong>In reply to:</strong> <a href="2417.html">Shawn Jefferson: "[cc65] Strange problem"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="2420.html">Shawn Jefferson: "Re: [cc65] Strange problem"</a>
<li><strong>Next in thread:</strong> <a href="../2002-07/1504.html">cbmnut_at_hushmail.com: "Re: Re: [cc65] Strange problem"</a>
<li><strong>Maybe reply:</strong> <a href="../2002-07/1504.html">cbmnut_at_hushmail.com: "Re: Re: [cc65] Strange problem"</a>
<li><strong>Maybe reply:</strong> <a href="../2002-07/1506.html">Shawn Jefferson: "Re: Re: [cc65] Strange problem"</a>
<!-- reply="end" -->
</ul>
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<p>
<small>
<em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.3</a> 
: <em>2003-02-06 10:46:12 CET</em>
</em>
</small>
</body>
</html>
