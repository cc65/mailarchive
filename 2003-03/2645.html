<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<title>cc65 mailing list archive: Re: [cc65] Floating point support (w</title>
<meta name="Author" content="Spiro Trikaliotis (spiro.trikaliotis_at_gmx.de)">
<meta name="Subject" content="Re: [cc65] Floating point support (was: C++ compiler)">
</head>
<body bgcolor="#FFFFFF" text="#000000">
<h1>Re: [cc65] Floating point support (was: C++ compiler)</h1>
<!-- received="Fri Mar  7 07:31:00 2003" -->
<!-- isoreceived="20030307063100" -->
<!-- sent="Fri, 7 Mar 2003 07:26:46 +0100" -->
<!-- isosent="20030307062646" -->
<!-- name="Spiro Trikaliotis" -->
<!-- email="spiro.trikaliotis_at_gmx.de" -->
<!-- subject="Re: [cc65] Floating point support (was: C++ compiler)" -->
<!-- id="070801c2e473$6fdece80$8043cad4@cs.unimagdeburg.de" -->
<!-- inreplyto="20030306232012.GA19133@trixie.musoftware.de" -->
<!-- expires="-1" -->
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<p>
<strong>From:</strong> Spiro Trikaliotis (<a href="mailto:spiro.trikaliotis_at_gmx.de?Subject=Re:%20[cc65]%20Floating%20point%20support%20(was:%20C%2B%2B%20compiler)"><em>spiro.trikaliotis_at_gmx.de</em></a>)<br>
<strong>Date:</strong> 2003-03-07 07:26:46
<p>
<!-- next="start" -->
<ul>
<li><strong>Previous message:</strong> <a href="2644.html">Groepaz: "Re: [cc65] using newline in cprintf on c64"</a>
<li><strong>In reply to:</strong> <a href="2629.html">Ullrich von Bassewitz: "Re: [cc65] Floating point support (was: C++ compiler)"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="2646.html">Ullrich von Bassewitz: "Re: [cc65] Floating point support (was: C++ compiler)"</a>
<li><strong>Next in thread:</strong> <a href="2628.html">Groepaz: "Re: [cc65] Floating point support (was: C++ compiler)"</a>
<li><strong>Reply:</strong> <a href="2646.html">Ullrich von Bassewitz: "Re: [cc65] Floating point support (was: C++ compiler)"</a>
<!-- reply="end" -->
</ul>
<hr noshade><p>
<!-- body="start" -->
<pre>
Hello,

Ullrich von Bassewitz wrote on Friday, March 07, 2003 12:20 AM:

&gt;   * ...standard violating. The standard requires that the compiler uses the
&gt;     same rules as the target platform when calculating floating point results.
&gt;     The result of
&gt; 
&gt;         double a = 1.0 / 3.0;   /* Evaluated at compile time */
&gt; 
&gt;     must be the same as
&gt; 
&gt;         double a = 1.0;
&gt;         double b = 3.0;
&gt;         ...
&gt;         double c = a / b;       /* Evaluated at runtime */
&gt; 
&gt;     So either the compiler would reimplement all ROM routines for all existing
&gt;     platforms or it would violate the standard.

Well, the standard even requires that compilation with and w/o optimizations
returns the same values. As even gcc on an iA32 fails to do that, I think it
would not be so bad if CC65 would violate it &quot;a little&quot;, too. ;-)

The problem with gcc on iA32: The iA32 FP unit does every calculation with
80 bit, but stores are in 32 (float) or 64 (double) bit.

If intermediate results are stored in memory, the processor rounds them. As
the storage is different in optimized (-O2) and not optimized code (-O0), you
sometimes get very different results.

Anyway trying to tell me that this is a problem of the architecture and not
of the compiler: MS VC++ (for sure) and the Intel compiler (I think) don't 
have that problem, they produce the same results with and without optimization.

This does not apply if you use long double (80 bit) on gcc, btw.


Anyway, your argument on the different formats which the compiler must generate
is truly a valid one.

Regarding the IEEE 754 standard, I think you have possibilities to reduce your
code size. As fas as I know (never have seen that standard, only books speaking
of it), the denormalized numbers are not required. Processing of the different
&quot;error codes&quot; (+/-NaN, +/-infinity, ...) could be &quot;unified&quot;, ... 

Although I would find it interesting, I surely would not be the person to do
that - but the people wanting this feature might try to implement some basic
functions (add, sub, mul and div) and I'm almost sure that Uz would not add
support in the compiler as soon as these routines prove to be usefull.

Wanting him to add support when the functions are not there is not a good
idea, as it would take his time, and as we all know, it is not that likely that
someone would fill in the gap of the routines, except Uz himself.

Spiro.

----------------------------------------------------------------------
To unsubscribe from the list send mail to <a href="mailto:majordomo_at_musoftware.de?Subject=Re:%20[cc65]%20Floating%20point%20support%20(was:%20C%2B%2B%20compiler)">majordomo_at_musoftware.de</a> with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<p><!-- body="end" -->
<hr noshade>
<ul>
<!-- next="start" -->
<li><strong>Previous message:</strong> <a href="2644.html">Groepaz: "Re: [cc65] using newline in cprintf on c64"</a>
<li><strong>In reply to:</strong> <a href="2629.html">Ullrich von Bassewitz: "Re: [cc65] Floating point support (was: C++ compiler)"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="2646.html">Ullrich von Bassewitz: "Re: [cc65] Floating point support (was: C++ compiler)"</a>
<li><strong>Next in thread:</strong> <a href="2628.html">Groepaz: "Re: [cc65] Floating point support (was: C++ compiler)"</a>
<li><strong>Reply:</strong> <a href="2646.html">Ullrich von Bassewitz: "Re: [cc65] Floating point support (was: C++ compiler)"</a>
<!-- reply="end" -->
</ul>
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<p>
<small>
<em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.3</a> 
: <em>2003-03-07 07:31:21 CET</em>
</em>
</small>
</body>
</html>
