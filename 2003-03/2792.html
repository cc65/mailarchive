<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<title>cc65 mailing list archive: Re: [cc65] The Contiki Desktop OS fo</title>
<meta name="Author" content="Adam Dunkels (adam_at_sics.se)">
<meta name="Subject" content="Re: [cc65] The Contiki Desktop OS for cc65">
</head>
<body bgcolor="#FFFFFF" text="#000000">
<h1>Re: [cc65] The Contiki Desktop OS for cc65</h1>
<!-- received="Sun Mar 16 08:14:02 2003" -->
<!-- isoreceived="20030316071402" -->
<!-- sent="16 Mar 2003 08:12:57 +0100" -->
<!-- isosent="20030316071257" -->
<!-- name="Adam Dunkels" -->
<!-- email="adam_at_sics.se" -->
<!-- subject="Re: [cc65] The Contiki Desktop OS for cc65" -->
<!-- id="1047798776.349.272.camel@localhost" -->
<!-- inreplyto="20030316003108.GB3233@trixie.musoftware.de" -->
<!-- expires="-1" -->
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<p>
<strong>From:</strong> Adam Dunkels (<a href="mailto:adam_at_sics.se?Subject=Re:%20[cc65]%20The%20Contiki%20Desktop%20OS%20for%20cc65"><em>adam_at_sics.se</em></a>)<br>
<strong>Date:</strong> 2003-03-16 08:12:57
<p>
<!-- next="start" -->
<ul>
<li><strong>Previous message:</strong> <a href="2791.html">Ullrich von Bassewitz: "Re: [cc65] The Contiki Desktop OS for cc65"</a>
<li><strong>In reply to:</strong> <a href="2791.html">Ullrich von Bassewitz: "Re: [cc65] The Contiki Desktop OS for cc65"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="2794.html">Ullrich von Bassewitz: "Re: [cc65] The Contiki Desktop OS for cc65"</a>
<li><strong>Next in thread:</strong> <a href="2720.html">josef.soucek_at_ct.cz: "RE: Re: [cc65] The Contiki Desktop OS for cc65"</a>
<li><strong>Maybe reply:</strong> <a href="2720.html">josef.soucek_at_ct.cz: "RE: Re: [cc65] The Contiki Desktop OS for cc65"</a>
<li><strong>Maybe reply:</strong> <a href="2721.html">josef.soucek_at_ct.cz: "RE: Re: [cc65] The Contiki Desktop OS for cc65"</a>
<li><strong>Maybe reply:</strong> <a href="2742.html">josef.soucek_at_ct.cz: "RE: Re: [cc65] The Contiki Desktop OS for cc65"</a>
<li><strong>Reply:</strong> <a href="2794.html">Ullrich von Bassewitz: "Re: [cc65] The Contiki Desktop OS for cc65"</a>
<!-- reply="end" -->
</ul>
<hr noshade><p>
<!-- body="start" -->
<pre>
Hi!

On Sun, 2003-03-16 at 01:31, Ullrich von Bassewitz wrote:
&gt; &gt; As Uz wrote in another mail in this thread, it isn't possible (or at
&gt; &gt; least not advisable) to have dynamically linked functions in the module
&gt; &gt; (i.e., the Contiki application program). So, instead we statically link
&gt; &gt; all external functions and variables in the application program to the
&gt; &gt; memory mappings of a well-defined Contiki version. For instance, lets
&gt; &gt; say Contiki 1.1 gets loadable program support. In the C64 version of
&gt; &gt; Contiki 1.1, the function ctk_widget_redraw() is put in memory 0x3ce1.
&gt; &gt; Now, when we compile and link our Contiki application programs, all
&gt; &gt; calls to ctk_widget_redraw() will be statically linked so that they will
&gt; &gt; correspond to a call too 0x3ec1.
&gt; 
&gt; You can also do this for the runtime functions that are linked to Contiki.
&gt; What you need is some advanced perl magic that does the following:
&gt; 
&gt;   1. Extract the list of public functions from the map file (or debug info or
&gt;      whatever) together with their address.
&gt; 
&gt;   2. Create one big assembler file that just contains lines like
&gt; 
&gt;         .export booleq
&gt;         booleq  = $1257
&gt;         .export mulax
&gt;         mulax   = $2312
&gt; 
&gt;      and so on.
&gt; 
&gt;   3. Assemble this file and link it to your module *before* the standard
&gt;      library. This will cause the linker to use the symbols from this file,
&gt;      and only ressort to the code in the standard library if there is no such
&gt;      symbol exported from the Contiki main program.
&gt; 
&gt; Since the map file contains all public symbols, it would even be possible to
&gt; access variables from the module.

This sounds very, very interesting, and not too complicated either!

Would it be possible to make library file out of the compiled assmebler
file created in step 2, together with a small crt0.s which just calls
_main, and then compile Contiki programs as regular programs, but by
linking to the special Contiki library? Could the resulting binary be
turned into a o65 module?

This way, Contiki programs could be written with a main() function
similar to ordinary programs.

Am I totally &quot;out there&quot;, or is there some sense in my thinking? :-)
 
/adam
-- 
Adam Dunkels &lt;<a href="mailto:adam_at_sics.se?Subject=Re:%20[cc65]%20The%20Contiki%20Desktop%20OS%20for%20cc65">adam_at_sics.se</a>&gt;
<a href="http://www.sics.se/~adam/">http://www.sics.se/~adam/</a>

----------------------------------------------------------------------
To unsubscribe from the list send mail to <a href="mailto:majordomo_at_musoftware.de?Subject=Re:%20[cc65]%20The%20Contiki%20Desktop%20OS%20for%20cc65">majordomo_at_musoftware.de</a> with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<p><!-- body="end" -->
<hr noshade>
<ul>
<!-- next="start" -->
<li><strong>Previous message:</strong> <a href="2791.html">Ullrich von Bassewitz: "Re: [cc65] The Contiki Desktop OS for cc65"</a>
<li><strong>In reply to:</strong> <a href="2791.html">Ullrich von Bassewitz: "Re: [cc65] The Contiki Desktop OS for cc65"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="2794.html">Ullrich von Bassewitz: "Re: [cc65] The Contiki Desktop OS for cc65"</a>
<li><strong>Next in thread:</strong> <a href="2720.html">josef.soucek_at_ct.cz: "RE: Re: [cc65] The Contiki Desktop OS for cc65"</a>
<li><strong>Maybe reply:</strong> <a href="2720.html">josef.soucek_at_ct.cz: "RE: Re: [cc65] The Contiki Desktop OS for cc65"</a>
<li><strong>Maybe reply:</strong> <a href="2721.html">josef.soucek_at_ct.cz: "RE: Re: [cc65] The Contiki Desktop OS for cc65"</a>
<li><strong>Maybe reply:</strong> <a href="2742.html">josef.soucek_at_ct.cz: "RE: Re: [cc65] The Contiki Desktop OS for cc65"</a>
<li><strong>Reply:</strong> <a href="2794.html">Ullrich von Bassewitz: "Re: [cc65] The Contiki Desktop OS for cc65"</a>
<!-- reply="end" -->
</ul>
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<p>
<small>
<em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.3</a> 
: <em>2003-03-16 08:14:25 CET</em>
</em>
</small>
</body>
</html>
