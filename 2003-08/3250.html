<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<title>cc65 mailing list archive: [cc65] MD5 checksum (ulongs really)</title>
<meta name="Author" content="Maciej Witkowiak (ytm_at_elysium.pl)">
<meta name="Subject" content="[cc65] MD5 checksum (ulongs really)">
</head>
<body bgcolor="#FFFFFF" text="#000000">
<h1>[cc65] MD5 checksum (ulongs really)</h1>
<!-- received="Tue Aug 19 16:15:21 2003" -->
<!-- isoreceived="20030819141521" -->
<!-- sent="Tue, 19 Aug 2003 16:14:17 +0200" -->
<!-- isosent="20030819141417" -->
<!-- name="Maciej Witkowiak" -->
<!-- email="ytm_at_elysium.pl" -->
<!-- subject="[cc65] MD5 checksum (ulongs really)" -->
<!-- id="20030819141417.GA2117@spektr.localdomain" -->
<!-- expires="-1" -->
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<p>
<strong>From:</strong> Maciej Witkowiak (<a href="mailto:ytm_at_elysium.pl?Subject=Re:%20[cc65]%20MD5%20checksum%20(ulongs%20really)"><em>ytm_at_elysium.pl</em></a>)<br>
<strong>Date:</strong> 2003-08-19 16:14:17
<p>
<!-- next="start" -->
<ul>
<li><strong>Previous message:</strong> <a href="3249.html">Ullrich von Bassewitz: "[cc65] Version 2.9.2 of cc65 released"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="3252.html">Ullrich von Bassewitz: "Re: [cc65] MD5 checksum (ulongs really)"</a>
<li><strong>Reply:</strong> <a href="3252.html">Ullrich von Bassewitz: "Re: [cc65] MD5 checksum (ulongs really)"</a>
<li><strong>Reply:</strong> <a href="3257.html">Ullrich von Bassewitz: "Re: [cc65] MD5 checksum (ulongs really)"</a>
<!-- reply="end" -->
</ul>
<hr noshade><p>
<!-- body="start" -->
<pre>
Well, all you people downloading ISOz on your 6502 machinez can check md5 sums
now :)

I didn't bother to write a full-featured md5sum program, just take a reference
implementation from RFC 1321, rewrite function headers and use cc65 on it.

The reason I write here about it is that one functions needs to be changed and
I don't know if it is or not cc65 bug or should I read the docs.

Here is the original code (UINT4 is unsigned long int):

static void Decode (UINT4 *output, unsigned char *input, unsigned int len) {
  unsigned int i, j;
  for (i = 0, j = 0; j &lt; len; i++, j += 4)
     output[i] = ((UINT4)input[j]) | (((UINT4)input[j+1]) &lt;&lt; 8) |
        (((UINT4)input[j+2]) &lt;&lt; 16) | (((UINT4)input[j+3]) &lt;&lt; 24);
 }

It doesn't work correctly.
Here is a version that works:

static void Decode (UINT4 *output, unsigned char *input, unsigned int len) {
  unsigned int i, j;
  union { char tab[4];
          UINT4 tabl; } uni;
  for (i = 0, j = 0; j &lt; len; i++, j += 4) {
      uni.tab[0]=input[j];   uni.tab[1]=input[j+1];
      uni.tab[2]=input[j+2]; uni.tab[3]=input[j+3];
      output[i]=uni.tabl;
   }
  }

There's more:

#define UINT4 unsigned long int
unsigned char input[4];
UINT4 output[1];

void foo(void) {
  unsigned int i,j;

  output[0]=i=j=0;
  input[0]=0x01; input[1]=0x02; input[2]=0x03; input[3]=0x04;

  output[i] = ((UINT4)input[j]) | (((UINT4)input[j+1]) &lt;&lt; 8) |
   (((UINT4)input[j+2]) &lt;&lt; 16) | (((UINT4)input[j+3]) &lt;&lt; 24);
  printf(&quot;%lu &quot;,output[i]);
  output[i] = (UINT4)input[j];
  printf(&quot;%lu &quot;,output[i]);

 }

With gcc I get:
67305985 1
With cc65 (CVS HEAD, with and without -Osir) I get:
3048407553 65537

ytm

----------------------------------------------------------------------
To unsubscribe from the list send mail to <a href="mailto:majordomo_at_musoftware.de?Subject=Re:%20[cc65]%20MD5%20checksum%20(ulongs%20really)">majordomo_at_musoftware.de</a> with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<p><!-- body="end" -->
<hr noshade>
<ul>
<!-- next="start" -->
<li><strong>Previous message:</strong> <a href="3249.html">Ullrich von Bassewitz: "[cc65] Version 2.9.2 of cc65 released"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="3252.html">Ullrich von Bassewitz: "Re: [cc65] MD5 checksum (ulongs really)"</a>
<li><strong>Reply:</strong> <a href="3252.html">Ullrich von Bassewitz: "Re: [cc65] MD5 checksum (ulongs really)"</a>
<li><strong>Reply:</strong> <a href="3257.html">Ullrich von Bassewitz: "Re: [cc65] MD5 checksum (ulongs really)"</a>
<!-- reply="end" -->
</ul>
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<p>
<small>
<em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.3</a> 
: <em>2003-08-19 16:19:23 CEST</em>
</em>
</small>
</body>
</html>
