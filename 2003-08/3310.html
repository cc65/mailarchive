<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<title>cc65 mailing list archive: Re: [cc65] Linker - Read-only warning</title>
<meta name="Author" content="Ullrich von Bassewitz (uz_at_musoftware.de)">
<meta name="Subject" content="Re: [cc65] Linker - Read-only warning">
</head>
<body bgcolor="#FFFFFF" text="#000000">
<h1>Re: [cc65] Linker - Read-only warning</h1>
<!-- received="Sat Aug 30 13:26:14 2003" -->
<!-- isoreceived="20030830112614" -->
<!-- sent="Sat, 30 Aug 2003 13:26:10 +0200" -->
<!-- isosent="20030830112610" -->
<!-- name="Ullrich von Bassewitz" -->
<!-- email="uz_at_musoftware.de" -->
<!-- subject="Re: [cc65] Linker - Read-only warning" -->
<!-- id="20030830112610.GA12672@trixie.musoftware.de" -->
<!-- inreplyto="1D2B2C77C9CF964EB1331ABEB51562E101C0F4C3@ukntsvr2.uk.drte.com" -->
<!-- expires="-1" -->
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<p>
<strong>From:</strong> Ullrich von Bassewitz (<a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20Linker%20-%20Read-only%20warning"><em>uz_at_musoftware.de</em></a>)<br>
<strong>Date:</strong> 2003-08-30 13:26:10
<p>
<!-- next="start" -->
<ul>
<li><strong>Previous message:</strong> <a href="3309.html">Groepaz: "Re: [cc65] snapshot"</a>
<li><strong>In reply to:</strong> <a href="3308.html">Keates, Mark: "RE: [cc65] Linker - Read-only warning"</a>
<!-- nextthread="start" -->
<!-- reply="end" -->
</ul>
<hr noshade><p>
<!-- body="start" -->
<pre>
On Fri, Aug 29, 2003 at 08:27:08AM -0400, Keates, Mark wrote:
&gt; A new question arises, if I wrote:
&gt;
&gt; 	.segment &quot;DATA1&quot;
&gt; MyData:
&gt; 	.rodata
&gt; MyReadOnly:
&gt;
&gt; Are the labels associated with the segment?
&gt; i.e. if RODATA and DATA1 have the same base then
&gt; would checks on STA MyData and STA MyReadOnly
&gt; be resolvable by the proposed check?

There are several relocatable items, some generated by the assembler, others
by the linker:

    a &quot;section&quot; is the part of a &quot;segment&quot; that comes from one object file.

    a &quot;segment&quot; is the collection of all &quot;sections&quot; depending on the decision
    of the linker which object files get linked to an executable.

    a &quot;memory area&quot; collects several &quot;segments&quot; and places them at a specific
    address.

In relocatable mode (that is, without a preceeding .ORG), labels in the
assembler are actually expressions that contain a reference to a section. The
linker can resolve these expressions, because, once all necessary object files
have been determined, each section has a fixed offset into a segment. And the
segment has a fixed offset into a memory area.

In answer to your question: Yes. The labels MyData and MyReadOnly will be
generated as expressions containing a reference to the &quot;DATA1&quot; and &quot;RODATA&quot;
sections respectively, so the linker knows to which segment you're storing,
even if the actual addresses are the same.

There's one problem however, which does also pop up in other places and is
related to the flexibility of the tools: An expression can contain more than
one section reference. For example:

        special = (MyData - MyReadOnly) &amp; $FFC0
        ...
        sta     special

In this case, the expression for the symbol &quot;special&quot; contains two segment
references: One to &quot;DATA1&quot; (coming from the MyData symbol), and one to
&quot;RODATA&quot; (coming from the MyReadOnly symbol). Features like the one above are
also the reason why it is not possible for the linker to convert all input to
o65 format: The o65 format (while it is quite complex for a machine like the
6502) cannot contain expressions with more than one segment reference, or with
anything else than addition or substraction of constants. There are no such
limits for the assembler/linker: Anything you're able to calculate in the
assembler may be passed to the linker; the complete expression is stored in
the object file regardless of its complexity.

Regards


        Uz


-- 
Ullrich von Bassewitz                                  <a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20Linker%20-%20Read-only%20warning">uz_at_musoftware.de</a>
----------------------------------------------------------------------
To unsubscribe from the list send mail to <a href="mailto:majordomo_at_musoftware.de?Subject=Re:%20[cc65]%20Linker%20-%20Read-only%20warning">majordomo_at_musoftware.de</a> with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<p><!-- body="end" -->
<hr noshade>
<ul>
<!-- next="start" -->
<li><strong>Previous message:</strong> <a href="3309.html">Groepaz: "Re: [cc65] snapshot"</a>
<li><strong>In reply to:</strong> <a href="3308.html">Keates, Mark: "RE: [cc65] Linker - Read-only warning"</a>
<!-- nextthread="start" -->
<!-- reply="end" -->
</ul>
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<p>
<small>
<em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.3</a> 
: <em>2003-08-30 13:27:08 CEST</em>
</em>
</small>
</body>
</html>
