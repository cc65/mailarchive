<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<title>cc65 mailing list archive: Re: [cc65] Optimizing C code</title>
<meta name="Author" content="Ullrich von Bassewitz (uz_at_musoftware.de)">
<meta name="Subject" content="Re: [cc65] Optimizing C code">
</head>
<body bgcolor="#FFFFFF" text="#000000">
<h1>Re: [cc65] Optimizing C code</h1>
<!-- received="Thu Sep  4 11:10:25 2003" -->
<!-- isoreceived="20030904091025" -->
<!-- sent="Thu, 4 Sep 2003 11:10:23 +0200" -->
<!-- isosent="20030904091023" -->
<!-- name="Ullrich von Bassewitz" -->
<!-- email="uz_at_musoftware.de" -->
<!-- subject="Re: [cc65] Optimizing C code" -->
<!-- id="20030904091023.GD31601@trixie.musoftware.de" -->
<!-- inreplyto="sf55e532.049@gwmail.sd62.bc.ca" -->
<!-- expires="-1" -->
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<p>
<strong>From:</strong> Ullrich von Bassewitz (<a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20Optimizing%20C%20code"><em>uz_at_musoftware.de</em></a>)<br>
<strong>Date:</strong> 2003-09-04 11:10:23
<p>
<!-- next="start" -->
<ul>
<li><strong>Previous message:</strong> <a href="3336.html">Ullrich von Bassewitz: "Re: [cc65] da65 + 65C02"</a>
<li><strong>In reply to:</strong> <a href="3327.html">Shawn Jefferson: "[cc65] Optimizing C code"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="3351.html">Shawn Jefferson: "Re: [cc65] Optimizing C code"</a>
<!-- reply="end" -->
</ul>
<hr noshade><p>
<!-- body="start" -->
<pre>
Hi!

On Wed, Sep 03, 2003 at 12:57:12PM -0700, Shawn Jefferson wrote:
&gt; I have a routine that plots pixels on a memory bitmap and am making an
&gt; attempt to optimize it.  I'm hoping some of you C wizards can help.

Some changes have already been suggested, here is more:

  1. Don't use var++, use ++var instead (I don't know how often I have written
     this, it really gets boring...).

  2. Make the x and y parameters unsigned.

  3. byte is not needed:

        index = BYTES_PER_LINE(bmp) * y + x / 4;

  4. mask is not really needed:

          if (creg != BAKCOL(bmp-&gt;mode)) {
              data |= (creg+1) &lt;&lt; plot4cshift[bit];
          }

  5. In fact, it is also possible to remove the data variable.


  6. The multiplication will kill your performance, so I would try to work
     around it.

  7. Calling a subroutine for each pixel passing 4 parameters over the stack
     is a performance problem for itself. I would suggest to use nested loops
     instead that plot whole rows or the complete picture. Doing this, it
     would also be possible to eliminate the multiplication (except for the
     start).

1. and 2. are mentioned explicitly in the docs (coding.xxxx), you may want to
(re-)read this document.

In general, it is a good idea to look at the generated assembler code. Doing
this, it is easy to spot areas where the compiler generated code is a problem.

Regards


        Uz


-- 
Ullrich von Bassewitz                                  <a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20Optimizing%20C%20code">uz_at_musoftware.de</a>
----------------------------------------------------------------------
To unsubscribe from the list send mail to <a href="mailto:majordomo_at_musoftware.de?Subject=Re:%20[cc65]%20Optimizing%20C%20code">majordomo_at_musoftware.de</a> with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<p><!-- body="end" -->
<hr noshade>
<ul>
<!-- next="start" -->
<li><strong>Previous message:</strong> <a href="3336.html">Ullrich von Bassewitz: "Re: [cc65] da65 + 65C02"</a>
<li><strong>In reply to:</strong> <a href="3327.html">Shawn Jefferson: "[cc65] Optimizing C code"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="3351.html">Shawn Jefferson: "Re: [cc65] Optimizing C code"</a>
<!-- reply="end" -->
</ul>
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<p>
<small>
<em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.3</a> 
: <em>2003-09-04 11:10:32 CEST</em>
</em>
</small>
</body>
</html>
