<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<title>cc65 mailing list archive: Re: [cc65] Struct embedded enum</title>
<meta name="Author" content="Ullrich von Bassewitz (uz_at_musoftware.de)">
<meta name="Subject" content="Re: [cc65] Struct embedded enum">
</head>
<body bgcolor="#FFFFFF" text="#000000">
<h1>Re: [cc65] Struct embedded enum</h1>
<!-- received="Thu Oct  9 20:12:38 2003" -->
<!-- isoreceived="20031009181238" -->
<!-- sent="Thu, 9 Oct 2003 20:12:34 +0200" -->
<!-- isosent="20031009181234" -->
<!-- name="Ullrich von Bassewitz" -->
<!-- email="uz_at_musoftware.de" -->
<!-- subject="Re: [cc65] Struct embedded enum" -->
<!-- id="20031009181234.GD20984@trixie.musoftware.de" -->
<!-- inreplyto="1D2B2C77C9CF964EB1331ABEB51562E101C0F5B9@ukntsvr2.uk.drte.com" -->
<!-- expires="-1" -->
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<p>
<strong>From:</strong> Ullrich von Bassewitz (<a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20Struct%20embedded%20enum"><em>uz_at_musoftware.de</em></a>)<br>
<strong>Date:</strong> 2003-10-09 20:12:34
<p>
<!-- next="start" -->
<ul>
<li><strong>Previous message:</strong> <a href="3592.html">Ullrich von Bassewitz: "Re: [cc65] Overflows in signed comparisions"</a>
<li><strong>In reply to:</strong> <a href="3591.html">Keates, Mark: "[cc65] Struct embedded enum"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="3595.html">Spiro Trikaliotis: "Re: [cc65] Struct embedded enum"</a>
<li><strong>Reply:</strong> <a href="3595.html">Spiro Trikaliotis: "Re: [cc65] Struct embedded enum"</a>
<!-- reply="end" -->
</ul>
<hr noshade><p>
<!-- body="start" -->
<pre>
Hi!

On Thu, Oct 09, 2003 at 06:43:24AM -0400, Keates, Mark wrote:
&gt; struct threadQueue {
&gt;     ...
&gt;     enum {
&gt;  	THREAD_JUST_BORN = 0,	/* Not &quot;start&quot;ed yet */
&gt;  	THREAD_ACTIVE = 1,	/* Currently running, or on Run queue */
&gt;  	THREAD_SUSPENDED = 2,   /* Waiting for monitor or alarm */
&gt;  	THREAD_DEAD = 3		/* Thread has quit */
&gt;     } state;
&gt; };
[...]
&gt; The question is, is there a specific way that the enum label could be
&gt; referenced?

C is rather inconsequent in regard to scoping. While struct members are local
to the struct, other structs and enums are not. This means that

    struct x {
        int foo;
        struct y {
            int bar;
        } Y;
    };

    struct y Y;

is legal C. The introduction of struct y in the scope of struct x is
misleading, it is actually globally visible. The same is true for enums.

cc65 is wrong when it comes to enums, it will add the enum tags to the local
scope of the struct, which is the way it is handled in most other languages.
I'm going to fix this, in the meantime, you may use

    if (CurrentThread-&gt;state == threadQueue.THREAD_ACTIVE) {

as a workaround.

&gt; I guess a better way would be to typedef the enum outside of the struct and
&gt; then
&gt; use then declare 'state' properly within the struct?

There shouldn't be a difference for the compiler, but it makes things clearer
for the programmer/maintainer. The declaration of threadQueue suggests that
the enum is local to the struct, but it is in fact a global type.

Regards


        Uz


-- 
Ullrich von Bassewitz                                  <a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20Struct%20embedded%20enum">uz_at_musoftware.de</a>
----------------------------------------------------------------------
To unsubscribe from the list send mail to <a href="mailto:majordomo_at_musoftware.de?Subject=Re:%20[cc65]%20Struct%20embedded%20enum">majordomo_at_musoftware.de</a> with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<p><!-- body="end" -->
<hr noshade>
<ul>
<!-- next="start" -->
<li><strong>Previous message:</strong> <a href="3592.html">Ullrich von Bassewitz: "Re: [cc65] Overflows in signed comparisions"</a>
<li><strong>In reply to:</strong> <a href="3591.html">Keates, Mark: "[cc65] Struct embedded enum"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="3595.html">Spiro Trikaliotis: "Re: [cc65] Struct embedded enum"</a>
<li><strong>Reply:</strong> <a href="3595.html">Spiro Trikaliotis: "Re: [cc65] Struct embedded enum"</a>
<!-- reply="end" -->
</ul>
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<p>
<small>
<em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.3</a> 
: <em>2003-10-09 20:12:46 CEST</em>
</em>
</small>
</body>
</html>
