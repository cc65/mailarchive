<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<title>cc65 mailing list archive: Re: [cc65] Optimizing code fails - F</title>
<meta name="Author" content="Ullrich von Bassewitz (uz_at_musoftware.de)">
<meta name="Subject" content="Re: [cc65] Optimizing code fails - Found the error!">
</head>
<body bgcolor="#FFFFFF" text="#000000">
<h1>Re: [cc65] Optimizing code fails - Found the error!</h1>
<!-- received="Sat Nov 22 12:54:35 2003" -->
<!-- isoreceived="20031122115435" -->
<!-- sent="Sat, 22 Nov 2003 12:54:32 +0100" -->
<!-- isosent="20031122115432" -->
<!-- name="Ullrich von Bassewitz" -->
<!-- email="uz_at_musoftware.de" -->
<!-- subject="Re: [cc65] Optimizing code fails - Found the error!" -->
<!-- id="20031122115432.GA1009@trixie.musoftware.de" -->
<!-- inreplyto="001201c3b0ed$252d7660$57dfb9d4@gmbigb" -->
<!-- expires="-1" -->
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<p>
<strong>From:</strong> Ullrich von Bassewitz (<a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20Optimizing%20code%20fails%20-%20Found%20the%20error!"><em>uz_at_musoftware.de</em></a>)<br>
<strong>Date:</strong> 2003-11-22 12:54:32
<p>
<!-- next="start" -->
<ul>
<li><strong>Previous message:</strong> <a href="3799.html">Benjamin Bahnsen: "Re: [cc65] Optimizing code fails - Found the error!"</a>
<li><strong>In reply to:</strong> <a href="3799.html">Benjamin Bahnsen: "Re: [cc65] Optimizing code fails - Found the error!"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="3801.html">Groepaz: "Re: [cc65] Optimizing code fails - Found the error!"</a>
<li><strong>Next in thread:</strong> <a href="3798.html">Groepaz: "Re: SPAMVERDACHT:[cc65] Optimizing code fails"</a>
<li><strong>Reply:</strong> <a href="3801.html">Groepaz: "Re: [cc65] Optimizing code fails - Found the error!"</a>
<li><strong>Reply:</strong> <a href="3802.html">MagerValp: "Re: [cc65] Optimizing code fails - Found the error!"</a>
<li><strong>Reply:</strong> <a href="3804.html">Spiro Trikaliotis: "Re: [cc65] Optimizing code fails - Found the error!"</a>
<li><strong>Reply:</strong> <a href="3810.html">Geoffrey Wossum: "Re: [cc65] Optimizing code fails - Found the error!"</a>
<!-- reply="end" -->
</ul>
<hr noshade><p>
<!-- body="start" -->
<pre>
Hi!

On Sat, Nov 22, 2003 at 12:38:26PM +0100, Benjamin Bahnsen wrote:
&gt; i finally found the problem. It seems to be a bug in the compiler.

Yes, it is one. But it's difficult so solve.

The optimizer knows which registers must be valid when returning from a
function by looking at the return type. A function returning void doesn't need
to return a value in a/x, so the optimizer will remove any code loading
something into these registers. This is what happened with your interrupt
procedure: The tax and tay instructions got removed, because the compiler
looked at the return type and decided they were unnecessary.

I have currently no idea how to change that without removing functionality.
Not the best idea, but at least a workaround to prevent people from falling
into this problem would be to remove the RTI instruction from the inline
assembler, so one will have to use the external assembler for interrupt
handlers. Better ideas anyone?

Regards


        Uz


-- 
Ullrich von Bassewitz                                  <a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20Optimizing%20code%20fails%20-%20Found%20the%20error!">uz_at_musoftware.de</a>
----------------------------------------------------------------------
To unsubscribe from the list send mail to <a href="mailto:majordomo_at_musoftware.de?Subject=Re:%20[cc65]%20Optimizing%20code%20fails%20-%20Found%20the%20error!">majordomo_at_musoftware.de</a> with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<p><!-- body="end" -->
<hr noshade>
<ul>
<!-- next="start" -->
<li><strong>Previous message:</strong> <a href="3799.html">Benjamin Bahnsen: "Re: [cc65] Optimizing code fails - Found the error!"</a>
<li><strong>In reply to:</strong> <a href="3799.html">Benjamin Bahnsen: "Re: [cc65] Optimizing code fails - Found the error!"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="3801.html">Groepaz: "Re: [cc65] Optimizing code fails - Found the error!"</a>
<li><strong>Next in thread:</strong> <a href="3798.html">Groepaz: "Re: SPAMVERDACHT:[cc65] Optimizing code fails"</a>
<li><strong>Reply:</strong> <a href="3801.html">Groepaz: "Re: [cc65] Optimizing code fails - Found the error!"</a>
<li><strong>Reply:</strong> <a href="3802.html">MagerValp: "Re: [cc65] Optimizing code fails - Found the error!"</a>
<li><strong>Reply:</strong> <a href="3804.html">Spiro Trikaliotis: "Re: [cc65] Optimizing code fails - Found the error!"</a>
<li><strong>Reply:</strong> <a href="3810.html">Geoffrey Wossum: "Re: [cc65] Optimizing code fails - Found the error!"</a>
<!-- reply="end" -->
</ul>
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<p>
<small>
<em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.3</a> 
: <em>2003-11-22 12:54:45 CET</em>
</em>
</small>
</body>
</html>
