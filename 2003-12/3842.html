<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
                      "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<title>cc65 mailing list archive: Re: [cc65] cosmetic and optimization</title>
<meta name="Author" content="Ullrich von Bassewitz (uz_at_musoftware.de)">
<meta name="Subject" content="Re: [cc65] cosmetic and optimization">
</head>
<body bgcolor="#FFFFFF" text="#000000">
<h1>Re: [cc65] cosmetic and optimization</h1>
<!-- received="Tue Dec  9 21:07:01 2003" -->
<!-- isoreceived="20031209200701" -->
<!-- sent="Tue, 9 Dec 2003 21:06:57 +0100" -->
<!-- isosent="20031209200657" -->
<!-- name="Ullrich von Bassewitz" -->
<!-- email="uz_at_musoftware.de" -->
<!-- subject="Re: [cc65] cosmetic and optimization" -->
<!-- id="20031209200657.GB1959@trixie.musoftware.de" -->
<!-- inreplyto="20031209181019.GK4791@trikaliotis.net" -->
<!-- expires="-1" -->
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<p>
<strong>From:</strong> Ullrich von Bassewitz (<a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20cosmetic%20and%20optimization"><em>uz_at_musoftware.de</em></a>)<br>
<strong>Date:</strong> 2003-12-09 21:06:57
<p>
<!-- next="start" -->
<ul>
<li><strong>Previous message:</strong> <a href="3841.html">Ullrich von Bassewitz: "Re: [cc65] Web page changes"</a>
<li><strong>In reply to:</strong> <a href="3840.html">Spiro Trikaliotis: "Re: [cc65] cosmetic and optimization"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="../2004-01/3930.html">carlos: "[cc65] assembly functions"</a>
<!-- reply="end" -->
</ul>
<hr noshade><p>
<!-- body="start" -->
<pre>
Hi!

On Tue, Dec 09, 2003 at 07:10:19PM +0100, Spiro Trikaliotis wrote:
&gt; Ok, I have not though about inline assembly.

It's not only inline assembly. Other optimization stages may generate such
code. Look at this:

        ldx     foobar+1
        tax
        sta     charvar
        lda     foobar
        ldx     foobar+1                ; #1: Get argument
        jsr     _some_function          ; Call a fastcall C function

As you can easily see, the second load of foobar+1 is unnecessary. Since a
call to a C function follows immediately, it is easy for the compiler to spot
this, so it may remove the instruction labeled #1. If a later step changes the
first three instructions and remove the load of X, you get into trouble. So
even if such code is never generated by the user or higher stages of the
compiler, the optimizer must know how to handle it. 

&gt; &gt;From your statement, I assume that cc65 optimizes on the assembly code
&gt; itself, not on any type of intermediate code?

Yes. The cc65 compiler is derived from Small C which generates assembly output
in one, direct step. A lot has changed since these days, but this is still as
it was. JRD had added a very simple peep hole optimizer as a separate program,
replacing known patterns of two or three consecutive lines (mostly subroutine
calls). When starting to extend the compiler I replaced this by an integrated
peep hole optimizer, but for a quite some time, this optimizer did pattern
matching on text lines, which prooved to be a nightmare to extend and
maintain. So I replaced the backend by an abstraction of 65C02 code. Each
instruction and each label is now a data structure, containing lots of
information about the context. This is not perfect but it made many things
possible that were not possible before. It would still be nice to have
optimizations also on a higher level, since some of the information available
there is lost when generating output.

&gt; From my rememberings of
&gt; compiler writing, a coverage analysis (which was told as being always
&gt; done) tells me when a value is surely not needed anymore, and such an
&gt; analysis would be done even for register contents in the optimization
&gt; state (well, I must admit that I think this was told in university, but
&gt; I'm not sure 100%). This information would be sufficient, but from your
&gt; statement, I assume this information is not available, is it?

The optimizer can tell when a register value is not needed any more. It does
even some flow analysis, so it can tell if a register has a specific value at
a branch label. I didn't say that the register information is not available in
my last mail, I just tried to give a reason why the issue is not as simple as
it looks. The optimization can be done, and in fact the compiler does lots of
more difficult optimizations, but it's not as simple as exchanging three lines
of code by two others.

Regards


        Uz


-- 
Ullrich von Bassewitz                                  <a href="mailto:uz_at_musoftware.de?Subject=Re:%20[cc65]%20cosmetic%20and%20optimization">uz_at_musoftware.de</a>
----------------------------------------------------------------------
To unsubscribe from the list send mail to <a href="mailto:majordomo_at_musoftware.de?Subject=Re:%20[cc65]%20cosmetic%20and%20optimization">majordomo_at_musoftware.de</a> with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<p><!-- body="end" -->
<hr noshade>
<ul>
<!-- next="start" -->
<li><strong>Previous message:</strong> <a href="3841.html">Ullrich von Bassewitz: "Re: [cc65] Web page changes"</a>
<li><strong>In reply to:</strong> <a href="3840.html">Spiro Trikaliotis: "Re: [cc65] cosmetic and optimization"</a>
<!-- nextthread="start" -->
<li><strong>Next in thread:</strong> <a href="../2004-01/3930.html">carlos: "[cc65] assembly functions"</a>
<!-- reply="end" -->
</ul>
<div align="center">
<table border="2" width="100%">
<tr>
<th><a href="date.html">Date view</a></th>
<th><a href="index.html">Thread view</a></th>
<th><a href="subject.html">Subject view</a></th>
</tr>
</table>
</div>
<!-- trailer="footer" -->
<p>
<small>
<em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.3</a> 
: <em>2003-12-09 21:07:21 CET</em>
</em>
</small>
</body>
</html>
