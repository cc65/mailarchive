<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="generator" content="hypermail 2.1.8, see http://www.hypermail.org/" />
<title>cc65 mailing list archive: [cc65] 65816 and ca65 : help needed</title>
<meta name="Author" content="chris (jlsfjs1yahoo.fr)" />
<meta name="Subject" content="[cc65] 65816 and ca65 : help needed" />
<meta name="Date" content="2005-12-12" />
<style type="text/css">
/*<![CDATA[*/
/* To be incorporated in the main stylesheet, don't code it in hypermail! */
body {color: black; background: #ffffff}
dfn {font-weight: bold;}
pre { background-color:inherit;}
.head { border-bottom:1px solid black;}
.foot { border-top:1px solid black;}
th {font-style:italic;}
table { margin-left:2em;}map ul {list-style:none;}
#mid { font-size:0.9em;}
#received { float:right;}
address { font-style:inherit ;}
/*]]>*/
.quotelev1 {color : #990099}
.quotelev2 {color : #ff7700}
.quotelev3 {color : #007799}
.quotelev4 {color : #95c500}
</style>
</head>
<body>
<div class="head">
<h1>[cc65] 65816 and ca65 : help needed</h1>
<!-- received="Mon Dec 12 17:38:22 2005" -->
<!-- isoreceived="20051212163822" -->
<!-- sent="Mon, 12 Dec 2005 17:29:31 +0100 (CET)" -->
<!-- isosent="20051212162931" -->
<!-- name="chris" -->
<!-- email="jlsfjs1yahoo.fr" -->
<!-- subject="[cc65] 65816 and ca65 : help needed" -->
<!-- id="20051212162931.16801.qmail@web25601.mail.ukl.yahoo.com" -->
<!-- charset="iso-8859-1" -->
<!-- inreplyto="200512111508.45172.groepaz&#64;gmx.net" -->
<!-- expires="-1" -->
<map id="navbar" name="navbar">
<ul class="links">
<li>
<dfn>This message</dfn>:
[ <a href="#start" name="options1" id="options1" tabindex="1">Message body</a> ]
 [ <a href="#options2">More options</a> ]
</li>
<li>
<dfn>Related messages</dfn>:
<!-- unext="start" -->
[ <a href="5361.html" title="Fatih : &quot;[cc65] Combining object libraries&quot;">Next message</a> ]
[ <a href="5359.html" title="Jørgen Aaris Henningsen: &quot;Re: [cc65] simple linker question&quot;">Previous message</a> ]
[ <a href="5353.html" title="Groepaz: &quot;Re: [cc65] 65816-based systems support&quot;">In reply to</a> ]
<!-- unextthread="start" -->
 [ <a href="5361.html" title="Fatih : &quot;[cc65] Combining object libraries&quot;">Next in thread</a> ]
 [ <a href="#replies">Replies</a> ]
<!-- ureply="end" -->
</li>
</ul>
</map>
</div>
<!-- body="start" -->
<div class="mail">
<address class="headers">
<span id="from">
<dfn>From</dfn>: chris &lt;<a href="mailto:jlsfjs1yahoo.fr?Subject=Re:%20[cc65]%2065816%20and%20ca65%20:%20help%20needed">jlsfjs1yahoo.fr</a>&gt;
</span><br />
<span id="date"><dfn>Date</dfn>: 2005-12-12 17:29:31</span><br />
</address>
<pre id="body">
<a name="start" accesskey="j" id="start"></a>Hi, as stated in my previous message I'm trying to
make ca65 compile assembler files generated by lcc816
(this version commes from Toshiyasu Morita (I've tried
the one of C64 Wings OS author or had a look to the
one of Groepaz - too hard for me))

The compiler seems to work fine and produce out the
box APM Assembler files...

So, I'm trying to figure out how I could write a
translater between the two. Unfortunately it's been a
long since I've used APW and I don't have any
documentation (and been a while since the last time
I've coded something with the 65816). 

So I need your help to understand what the APW
Assembler statements are and how to convert them to
ca65 format.

Below are 3 test files : the C source code, the APW
asm source code and the ca65 asm source modified by
hand (by me) - See at the end of this post for errors
generated by ca65

1) main.c
int fn()
{
	return 0;
}

main()
{
	return 2;
}

2) main.s (APW assembler)
-0	data
_t	entry
	dc	i4'1'
	end
; STARTFUNC(%0),(_fn)
_fn	start
dag_temp_start	equ	1
gen_temp_start	equ	dag_temp_start+0
local	equ	gen_temp_start+-1
; LINK(),()
	lda	r15
	add.l	#-local
	sta	r15
; RETI(CNSTI(%0)),(0)
	tsc
	clc
	adc	#local
	tcs
	pld
	lda	#&lt;0
	ldx	#^0
	rtl
; LABELV(%0),(L1)
L1	anop
; ENDFUNC(%0),(_fn)
_fn	end
; FLUSH(),()
; STARTFUNC(%0),(_main)
_main	start
dag_temp_start	equ	1
gen_temp_start	equ	dag_temp_start+0
local	equ	gen_temp_start+-1
; LINK(),()
	lda	r15
	add.l	#-local
	sta	r15
; RETI(CNSTI(%0)),(2)
	tsc
	clc
	adc	#local
	tcs
	pld
	lda	#&lt;2
	ldx	#^2
	rtl
; LABELV(%0),(L2)
L2	anop
; ENDFUNC(%0),(_main)
_main	end
; FLUSH(),()
	end
; FLUSH(),()

3) main.ca65
.P816
;-0	data
;_t	entry
;	dc	i4'1'
;	end
; STARTFUNC(%0),(_fn)
_fn:	.SCOPE
dag_temp_start	=	1
gen_temp_start	= dag_temp_start+0
local	= gen_temp_start+-1
; LINK(),()
	lda	r15
	add #-local
	sta	r15
; RETI(CNSTI(%0)),(0)
	tsc
	clc
	adc	#local
	tcs
	pld
	lda	#&lt;0
	ldx	#^0
	rtl
; LABELV(%0),(L1)
L1:	
; ENDFUNC(%0),(_fn)
_fn:	.ENDSCOPE
; FLUSH(),()
; STARTFUNC(%0),(_main)
_main:	.SCOPE
	dag_temp_start	= 1
	gen_temp_start	= dag_temp_start+0
local	= gen_temp_start+-1
; LINK(),()
	lda	r15
	add	#-local
	sta	r15
; RETI(CNSTI(%0)),(2)
	tsc
	clc
	adc	#-local
	tcs
	pld
	lda	#&lt;2
	ldx	#^2
	rtl
; LABELV(%0),(L2)
L2:	
; ENDFUNC(%0),(_main)
_main: .ENDSCOPE
; FLUSH(),()
	
; FLUSH(),()

PROBLEMS :
==========

1) I don't know it the way I've converted the EQU is
right
2) add #-local produce an error ( Error: `:' expected
main.ca65(13): Error: Unexpected trailing garbage
characters
)
3) it was add.l, and I don't remember a add.l opcode
for the 65816 so I presume it's an APW macro ? but
which one ?

And should learn with ca65 how to convert dc i4'1'
(bytes reservation I presume)

Huuu, bad stuff for me no ? ;-)

If you can help...


	

	
		
___________________________________________________________________________ 
Appel audio GRATUIT partout dans le monde avec le nouveau Yahoo! Messenger 
Téléchargez cette version sur <a href="http://fr.messenger.yahoo.com">http://fr.messenger.yahoo.com</a>
----------------------------------------------------------------------
To unsubscribe from the list send mail to majordomo&#64;musoftware&#46;<!--nospam-->de with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<span id="received"><dfn>Received on</dfn> Mon Dec 12 17:38:22 2005</span>
</div>
<!-- body="end" -->
<div class="foot">
<map id="navbarfoot" name="navbarfoot" title="Related messages">
<ul class="links">
<li><dfn>This message</dfn>: [ <a href="#start">Message body</a> ]</li>
<!-- lnext="start" -->
<li><dfn>Next message</dfn>: <a href="5361.html" title="Next message in the list">Fatih : "[cc65] Combining object libraries"</a></li>
<li><dfn>Previous message</dfn>: <a href="5359.html" title="Previous message in the list">Jørgen Aaris Henningsen: "Re: [cc65] simple linker question"</a></li>
<li><dfn>In reply to</dfn>: <a href="5353.html" title="Message to which this message replies">Groepaz: "Re: [cc65] 65816-based systems support"</a></li>
<!-- lnextthread="start" -->
<li><dfn>Next in thread</dfn>: <a href="5361.html" title="Next message in this discussion thread">Fatih : "[cc65] Combining object libraries"</a></li>
<li><a name="replies" id="replies"></a><dfn>Reply</dfn>:  <a href="5361.html" title="Message sent in reply to this message">Fatih : "[cc65] Combining object libraries"</a></li>
<li><dfn>Reply</dfn>:  <a href="5362.html" title="Message sent in reply to this message">Ullrich von Bassewitz: "Re: [cc65] 65816 and ca65 : help needed"</a></li>
<li><dfn>Maybe reply</dfn>:  <a href="5379.html" title="Message sent in reply to this message">Greg King: "Re: [cc65] 65816 and ca65 : help needed"</a></li>
<!-- lreply="end" -->
</ul>
<ul class="links">
<li><a name="options2" id="options2"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="date.html#5360" title="Contemporary messages by date">By Date</a> ] [ <a href="index.html#5360" title="Contemporary discussion threads">By Thread</a> ] [ <a href="subject.html#5360" title="Contemporary messages by subject">By Subject</a> ]</ul>
</map>
</div>
<!-- trailer="footer" -->
<p><small><em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.8</a> 
: 2005-12-12 17:38:28 CET
</em></small></p>
</body>
</html>
