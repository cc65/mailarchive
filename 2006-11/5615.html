<?xml version="1.0" encoding="ISO-2022-JP"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-2022-JP" />
<meta name="generator" content="hypermail 2.1.8, see http://www.hypermail.org/" />
<title>cc65 mailing list archive: [cc65] CC65 and Stack Pointer</title>
<meta name="Author" content="Hiroji Kimura (us3h-kmr1asahi-net.or.jp)" />
<meta name="Subject" content="[cc65] CC65 and Stack Pointer" />
<meta name="Date" content="2006-11-28" />
<style type="text/css">
/*<![CDATA[*/
/* To be incorporated in the main stylesheet, don't code it in hypermail! */
body {color: black; background: #ffffff}
dfn {font-weight: bold;}
pre { background-color:inherit;}
.head { border-bottom:1px solid black;}
.foot { border-top:1px solid black;}
th {font-style:italic;}
table { margin-left:2em;}map ul {list-style:none;}
#mid { font-size:0.9em;}
#received { float:right;}
address { font-style:inherit ;}
/*]]>*/
.quotelev1 {color : #990099}
.quotelev2 {color : #ff7700}
.quotelev3 {color : #007799}
.quotelev4 {color : #95c500}
</style>
</head>
<body>
<div class="head">
<h1>[cc65] CC65 and Stack Pointer</h1>
<!-- received="Tue Nov 28 19:16:54 2006" -->
<!-- isoreceived="20061128181654" -->
<!-- sent="Wed, 29 Nov 2006 03:16:41 +0900" -->
<!-- isosent="20061128181641" -->
<!-- name="Hiroji Kimura" -->
<!-- email="us3h-kmr1asahi-net.or.jp" -->
<!-- subject="[cc65] CC65 and Stack Pointer" -->
<!-- id="456C7D09.8050601@asahi-net.or.jp" -->
<!-- charset="ISO-2022-JP" -->
<!-- expires="-1" -->
<map id="navbar" name="navbar">
<ul class="links">
<li>
<dfn>This message</dfn>:
[ <a href="#start" name="options1" id="options1" tabindex="1">Message body</a> ]
 [ <a href="#options2">More options</a> ]
</li>
<li>
<dfn>Related messages</dfn>:
<!-- unext="start" -->
[ <a href="5616.html" title="Ullrich von Bassewitz: &quot;Re: [cc65] CC65 and Stack Pointer&quot;">Next message</a> ]
[ <a href="5614.html" title="Ullrich von Bassewitz: &quot;Re: [cc65] Problems playing Goattracker BIN files&quot;">Previous message</a> ]
<!-- unextthread="start" -->
 [ <a href="5616.html" title="Ullrich von Bassewitz: &quot;Re: [cc65] CC65 and Stack Pointer&quot;">Next in thread</a> ]
 [ <a href="#replies">Replies</a> ]
<!-- ureply="end" -->
</li>
</ul>
</map>
</div>
<!-- body="start" -->
<div class="mail">
<address class="headers">
<span id="from">
<dfn>From</dfn>: Hiroji Kimura &lt;<a href="mailto:us3h-kmr1asahi-net.or.jp?Subject=Re:%20[cc65]%20CC65%20and%20Stack%20Pointer">us3h-kmr1asahi-net.or.jp</a>&gt;
</span><br />
<span id="date"><dfn>Date</dfn>: 2006-11-28 19:16:41</span><br />
</address>
<pre id="body">
<a name="start" accesskey="j" id="start"></a>Hello,

Let me first mention that I don't use mailing lists usually. So please
let me know if this is not the right place to ask the questions that I
am asking.

I'm developing teaching materials based on a 6502 CPU for a national
university in Japan.  We will be teaching the students how to build a
calculator out of a 6502 with sound. This 6502 is created using a FPGA
based board with a 4x4 matrix keyboard, a video output, and a sound output.

Since we didn't know about the sp (stack pointer) used by the code
generated by the cc65 compiler,  we had the system crashing every time
the stack was used when the stack pointer pointed at the interrupt
vector addresses ($FFFA-$FFFF) and an interrupt occurred.  The system
that we are using initializes the zero page with 0's.  The sp pointed at
the address of $0000. Since the sp grows downwards the next address
would be $FFFF when pushax subroutine is called.

Now we finally tacked down the problem of not initializing the sp. So
we've decided to initialize it to point to somewhere like $FFF0 in
start.s which is our startup routine.

Now I have three questions.

Questions:

1. Is it correct to say there are two stacks in the system? The true
hardware stack provided by the 6502 and the stack used by the code
generated by cc65.

2. Does our way of initializing the sp have any flaws?

3. Upon entering the interrupt handler do we need to push registers and
pop them before RTI?

Here is the related portion of our startup routine.

Start.s :


//////////////////////////////////////////////////////
;------------------------------------------
; zero clear of uninitialized data segment
;------------------------------------------
        LDX #00
LOOP:   LDA #$00
        STA __BSS_RUN__
        INX
        CPX __BSS_SIZE__
        BNE LOOP

    CLI

;------------------------------------------
; call main routine
;------------------------------------------
    LDA #$F0    ; &lt;&lt;&lt;&lt;------------- HERE WE ARE INITIALIZING THE SP
    STA $0000
    LDA #$FF
    STA $0001
    JMP _main


;**************************************************************************
; IRQ Program
;**************************************************************************
    .SEGMENT    &quot;CODE&quot;
_irq:
   JSR _sound
    CLI
    RTI

    .END
//////////////////////////////////////////////////////////////////////////////////



Hiroji Kimura
----------------------------------------------------------------------
To unsubscribe from the list send mail to majordomo&#64;musoftware&#46;<!--nospam-->de with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<span id="received"><dfn>Received on</dfn> Tue Nov 28 19:16:54 2006</span>
</div>
<!-- body="end" -->
<div class="foot">
<map id="navbarfoot" name="navbarfoot" title="Related messages">
<ul class="links">
<li><dfn>This message</dfn>: [ <a href="#start">Message body</a> ]</li>
<!-- lnext="start" -->
<li><dfn>Next message</dfn>: <a href="5616.html" title="Next message in the list">Ullrich von Bassewitz: "Re: [cc65] CC65 and Stack Pointer"</a></li>
<li><dfn>Previous message</dfn>: <a href="5614.html" title="Previous message in the list">Ullrich von Bassewitz: "Re: [cc65] Problems playing Goattracker BIN files"</a></li>
<!-- lnextthread="start" -->
<li><dfn>Next in thread</dfn>: <a href="5616.html" title="Next message in this discussion thread">Ullrich von Bassewitz: "Re: [cc65] CC65 and Stack Pointer"</a></li>
<li><a name="replies" id="replies"></a><dfn>Reply</dfn>:  <a href="5616.html" title="Message sent in reply to this message">Ullrich von Bassewitz: "Re: [cc65] CC65 and Stack Pointer"</a></li>
<!-- lreply="end" -->
</ul>
<ul class="links">
<li><a name="options2" id="options2"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="date.html#5615" title="Contemporary messages by date">By Date</a> ] [ <a href="index.html#5615" title="Contemporary discussion threads">By Thread</a> ] [ <a href="subject.html#5615" title="Contemporary messages by subject">By Subject</a> ]</ul>
</map>
</div>
<!-- trailer="footer" -->
<p><small><em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.8</a> 
: 2006-11-28 19:16:57 CET
</em></small></p>
</body>
</html>
