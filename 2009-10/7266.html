<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="hypermail 2.1.8, see http://www.hypermail.org/" />
<title>cc65 mailing list archive: Re: [cc65] Optimization possible?</title>
<meta name="Author" content="Ullrich von Bassewitz (uz1musoftware.de)" />
<meta name="Subject" content="Re: [cc65] Optimization possible?" />
<meta name="Date" content="2009-10-24" />
<style type="text/css">
/*<![CDATA[*/
/* To be incorporated in the main stylesheet, don't code it in hypermail! */
body {color: black; background: #ffffff}
dfn {font-weight: bold;}
pre { background-color:inherit;}
.head { border-bottom:1px solid black;}
.foot { border-top:1px solid black;}
th {font-style:italic;}
table { margin-left:2em;}map ul {list-style:none;}
#mid { font-size:0.9em;}
#received { float:right;}
address { font-style:inherit ;}
/*]]>*/
.quotelev1 {color : #990099}
.quotelev2 {color : #ff7700}
.quotelev3 {color : #007799}
.quotelev4 {color : #95c500}
</style>
</head>
<body>
<div class="head">
<h1>Re: [cc65] Optimization possible?</h1>
<!-- received="Sat Oct 24 19:14:42 2009" -->
<!-- isoreceived="20091024171442" -->
<!-- sent="Sat, 24 Oct 2009 19:07:05 +0200" -->
<!-- isosent="20091024170705" -->
<!-- name="Ullrich von Bassewitz" -->
<!-- email="uz1musoftware.de" -->
<!-- subject="Re: [cc65] Optimization possible?" -->
<!-- id="20091024170705.GA23303@trixie.musoftware.de" -->
<!-- charset="utf-8" -->
<!-- inreplyto="11D807D90A180A202F35E&#64;directbox.com" -->
<!-- expires="-1" -->
<map id="navbar" name="navbar">
<ul class="links">
<li>
<dfn>This message</dfn>:
[ <a href="#start" name="options1" id="options1" tabindex="1">Message body</a> ]
 [ <a href="#options2">More options</a> ]
</li>
<li>
<dfn>Related messages</dfn>:
<!-- unext="start" -->
[ <a href="7267.html" title="Groepaz: &quot;Re: [cc65] Optimization possible?&quot;">Next message</a> ]
[ <a href="7265.html" title="Ullrich von Bassewitz: &quot;Re: &quot;Known bugs&quot; on cc65.org (was: [cc65] -Cl error?)&quot;">Previous message</a> ]
[ <a href="7261.html" title="Thomas Giesel: &quot;Re: Re: [cc65] Optimization possible?&quot;">In reply to</a> ]
<!-- unextthread="start" -->
 [ <a href="#replies">Replies</a> ]
<!-- ureply="end" -->
</li>
</ul>
</map>
</div>
<!-- body="start" -->
<div class="mail">
<address class="headers">
<span id="from">
<dfn>From</dfn>: Ullrich von Bassewitz &lt;<a href="mailto:uz1musoftware.de?Subject=Re:%20[cc65]%20Optimization%20possible?">uz1musoftware.de</a>&gt;
</span><br />
<span id="date"><dfn>Date</dfn>: 2009-10-24 19:07:05</span><br />
</address>
<pre id="body">
<a name="start" accesskey="j" id="start"></a>Hi!

On Sat, Oct 24, 2009 at 12:32:47PM +0000, Thomas Giesel wrote:
&gt; Is it possible to repeat the peephole optimization until no more changes happened?

This is already done, but it won't solve the order problem. In the given case,
there were (simplified) four replacements involved:

  1. One that generates code like

                adc     xxx
                bcc     L
                inx
        L:

     from more complex calls like tosaddax.

  2. One that checks for

                adc     xxx
                bcc     L
                inx
        L:

     (which is also generated by the compiler in some places) and removes
     it, if X isn't used later.

  3. Another one that check for a bcc to clc or bcs to sec and changes
     the branch to skip the instruction.

  4. A fourth one that removes register operations for a register that isn't
     used later.

Groepaz code had two additions, so after step one, the code looked like this:

                adc     xxx
                bcc     L
                inx
        L:      clc
                adc     #$01
                ldy     #$xx
                sta     (sp),y

Now step 3. was run and changed the code like this:

                adc     xxx
                bcc     L
                inx
                clc
        L:      adc     #$01
                ldy     #$xx
                sta     (sp),y

If you now run step 2. it won't find what it searches for. Step 4. will
finally remove the &quot;inx&quot;, since X isn't used later, and you end with:

                adc     xxx
                bcc     L
                clc
        L:      adc     #$01
                ldy     #$xx
                sta     (sp),y

As can be easily seen, repeating these steps won't generate a different
result, you have to change the order of the steps. In the given case, it is
clear that the choosen order was wrong for any case I can currently think of.
But this is not always the true. There may be code combinations for which one
order may be better, while reversing the order is better for another.

&gt; Maybe this could even reduce the number of rules and make the design about the
&gt; right order simple. Possibly I'm too naive...

In this special case: yes. :-)

Regards


        Uz

  

P.S.: Please don't write to my personal mailing address and cc: to the list
      (or the other way round). I promise, I'm reading the list, so writing to
      both addresses will just cause confusion.

-- 
Ullrich von Bassewitz                                  uz&#64;musoftware&#46;<!--nospam-->de
----------------------------------------------------------------------
To unsubscribe from the list send mail to majordomo&#64;musoftware&#46;<!--nospam-->de with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<span id="received"><dfn>Received on</dfn> Sat Oct 24 19:14:42 2009</span>
</div>
<!-- body="end" -->
<div class="foot">
<map id="navbarfoot" name="navbarfoot" title="Related messages">
<ul class="links">
<li><dfn>This message</dfn>: [ <a href="#start">Message body</a> ]</li>
<!-- lnext="start" -->
<li><dfn>Next message</dfn>: <a href="7267.html" title="Next message in the list">Groepaz: "Re: [cc65] Optimization possible?"</a></li>
<li><dfn>Previous message</dfn>: <a href="7265.html" title="Previous message in the list">Ullrich von Bassewitz: "Re: &quot;Known bugs&quot; on cc65.org (was: [cc65] -Cl error?)"</a></li>
<li><dfn>In reply to</dfn>: <a href="7261.html" title="Message to which this message replies">Thomas Giesel: "Re: Re: [cc65] Optimization possible?"</a></li>
<!-- lnextthread="start" -->
<li><a name="replies" id="replies"></a>
<dfn>Maybe reply</dfn>: <a href="7261.html" title="Message sent in reply to this message">Thomas Giesel: "Re: Re: [cc65] Optimization possible?"</a></li>
<li><dfn>Reply</dfn>:  <a href="7267.html" title="Message sent in reply to this message">Groepaz: "Re: [cc65] Optimization possible?"</a></li>
<!-- lreply="end" -->
</ul>
<ul class="links">
<li><a name="options2" id="options2"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="date.html#7266" title="Contemporary messages by date">By Date</a> ] [ <a href="index.html#7266" title="Contemporary discussion threads">By Thread</a> ] [ <a href="subject.html#7266" title="Contemporary messages by subject">By Subject</a> ]</ul>
</map>
</div>
<!-- trailer="footer" -->
<p><small><em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.8</a> 
: 2009-10-24 19:14:44 CEST
</em></small></p>
</body>
</html>
