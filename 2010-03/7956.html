<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="hypermail 2.1.8, see http://www.hypermail.org/" />
<title>cc65 mailing list archive: Re: [cc65] some patches</title>
<meta name="Author" content="Ullrich von Bassewitz (uz1musoftware.de)" />
<meta name="Subject" content="Re: [cc65] some patches" />
<meta name="Date" content="2010-03-15" />
<style type="text/css">
/*<![CDATA[*/
/* To be incorporated in the main stylesheet, don't code it in hypermail! */
body {color: black; background: #ffffff}
dfn {font-weight: bold;}
pre { background-color:inherit;}
.head { border-bottom:1px solid black;}
.foot { border-top:1px solid black;}
th {font-style:italic;}
table { margin-left:2em;}map ul {list-style:none;}
#mid { font-size:0.9em;}
#received { float:right;}
address { font-style:inherit ;}
/*]]>*/
.quotelev1 {color : #990099}
.quotelev2 {color : #ff7700}
.quotelev3 {color : #007799}
.quotelev4 {color : #95c500}
</style>
</head>
<body>
<div class="head">
<h1>Re: [cc65] some patches</h1>
<!-- received="Mon Mar 15 23:32:52 2010" -->
<!-- isoreceived="20100315223252" -->
<!-- sent="Mon, 15 Mar 2010 23:32:47 +0100" -->
<!-- isosent="20100315223247" -->
<!-- name="Ullrich von Bassewitz" -->
<!-- email="uz1musoftware.de" -->
<!-- subject="Re: [cc65] some patches" -->
<!-- id="20100315223247.GB2175@trixie.musoftware.de" -->
<!-- charset="utf-8" -->
<!-- inreplyto="4B9EABE2.6040509&#64;googlemail.com" -->
<!-- expires="-1" -->
<map id="navbar" name="navbar">
<ul class="links">
<li>
<dfn>This message</dfn>:
[ <a href="#start" name="options1" id="options1" tabindex="1">Message body</a> ]
 [ <a href="#options2">More options</a> ]
</li>
<li>
<dfn>Related messages</dfn>:
<!-- unext="start" -->
[ <a href="7957.html" title="Kajt·r Zsolt: &quot;Re: [cc65] some patches&quot;">Next message</a> ]
[ <a href="7955.html" title="Ullrich von Bassewitz: &quot;Re: [cc65] some patches&quot;">Previous message</a> ]
[ <a href="7954.html" title="Kajt·r Zsolt: &quot;Re: [cc65] some patches&quot;">In reply to</a> ]
<!-- unextthread="start" -->
 [ <a href="7958.html" title="Kajt·r Zsolt: &quot;Re: [cc65] some patches&quot;">Next in thread</a> ]
 [ <a href="#replies">Replies</a> ]
<!-- ureply="end" -->
</li>
</ul>
</map>
</div>
<!-- body="start" -->
<div class="mail">
<address class="headers">
<span id="from">
<dfn>From</dfn>: Ullrich von Bassewitz &lt;<a href="mailto:uz1musoftware.de?Subject=Re:%20[cc65]%20some%20patches">uz1musoftware.de</a>&gt;
</span><br />
<span id="date"><dfn>Date</dfn>: 2010-03-15 23:32:47</span><br />
</address>
<pre id="body">
<a name="start" accesskey="j" id="start"></a>On Mon, Mar 15, 2010 at 10:51:30PM +0100, Kajt√°r Zsolt wrote:
&gt; &gt; That's true. But the real problem is the amount of custom hardware that is in
&gt; &gt; use. It is impossible to support everybodys pet hardware in the standard cc65
&gt; &gt; libraries. I cannot produce a separate library for each combination of
&gt; &gt; patches. A library for the C64 without IDE64 routines for smaller size,
&gt;
&gt; Ok, of course it does not have to be compiled in by default. I was thinking
&gt; about something like this:
&gt;
&gt; #define __USE_IDE64
&gt;
&gt; At the beginning of a the user's program would redefine a few routine calls to
&gt; alternative versions in the library header files (stdio.h, unistd.h) for
&gt; read/write and possibly seek.

That doesn't work.

If you use printf, write() is called internally. printf calls fprintf which
calls vfprintf, which calls write. In this call chain, the address of write is
part of the precompiled library and a simple #define in the user code won't
change the contents of the library you're linking to your application.

&gt; What is the reason for the final RESTOR? Interrupts are restored already,
&gt; anything else?

The call to RESTOR is probably a relict from older versions that didn't have
destructors.  Some parts of the library set their own vectors (the debugger
for example takes over the BREAK vector). RESTOR is called so that even in
case of a program abort, the machine is not left in an unstable state. I
haven't checked the code, it may be possible to add destructors if they're not
already present and remove the call.

&gt; &gt; So we will have to live with the fact that the cc65 do only cover the most
&gt; &gt; common case. If it is cheap, they can also cover a few less common ones, too.
&gt;
&gt; There would be no cost if it's not selected.

How are you going to &quot;select&quot; it? As said above, using #defines won't work.
The only thing that works is a separate library, but ...

&gt; I'm not sure if this is a good idea, at least I would not do it.

... that doesn't seem to get your approval :-)

Regards


        Uz


-- 
Ullrich von Bassewitz                                  uz&#64;musoftware&#46;<!--nospam-->de
----------------------------------------------------------------------
To unsubscribe from the list send mail to majordomo&#64;musoftware&#46;<!--nospam-->de with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<span id="received"><dfn>Received on</dfn> Mon Mar 15 23:32:52 2010</span>
</div>
<!-- body="end" -->
<div class="foot">
<map id="navbarfoot" name="navbarfoot" title="Related messages">
<ul class="links">
<li><dfn>This message</dfn>: [ <a href="#start">Message body</a> ]</li>
<!-- lnext="start" -->
<li><dfn>Next message</dfn>: <a href="7957.html" title="Next message in the list">Kajt·r Zsolt: "Re: [cc65] some patches"</a></li>
<li><dfn>Previous message</dfn>: <a href="7955.html" title="Previous message in the list">Ullrich von Bassewitz: "Re: [cc65] some patches"</a></li>
<li><dfn>In reply to</dfn>: <a href="7954.html" title="Message to which this message replies">Kajt·r Zsolt: "Re: [cc65] some patches"</a></li>
<!-- lnextthread="start" -->
<li><dfn>Next in thread</dfn>: <a href="7958.html" title="Next message in this discussion thread">Kajt·r Zsolt: "Re: [cc65] some patches"</a></li>
<li><a name="replies" id="replies"></a><dfn>Reply</dfn>:  <a href="7958.html" title="Message sent in reply to this message">Kajt·r Zsolt: "Re: [cc65] some patches"</a></li>
<!-- lreply="end" -->
</ul>
<ul class="links">
<li><a name="options2" id="options2"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="date.html#7956" title="Contemporary messages by date">By Date</a> ] [ <a href="index.html#7956" title="Contemporary discussion threads">By Thread</a> ] [ <a href="subject.html#7956" title="Contemporary messages by subject">By Subject</a> ]</ul>
</map>
</div>
<!-- trailer="footer" -->
<p><small><em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.8</a> 
: 2010-03-15 23:32:54 CET
</em></small></p>
</body>
</html>
