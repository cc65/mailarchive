<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="hypermail 2.1.8, see http://www.hypermail.org/" />
<title>cc65 mailing list archive: Re: [cc65] How to force a read from a</title>
<meta name="Author" content="Ullrich von Bassewitz (uz1musoftware.de)" />
<meta name="Subject" content="Re: [cc65] How to force a read from a memory mapped register w/o volatile" />
<meta name="Date" content="2010-12-07" />
<style type="text/css">
/*<![CDATA[*/
/* To be incorporated in the main stylesheet, don't code it in hypermail! */
body {color: black; background: #ffffff}
dfn {font-weight: bold;}
pre { background-color:inherit;}
.head { border-bottom:1px solid black;}
.foot { border-top:1px solid black;}
th {font-style:italic;}
table { margin-left:2em;}map ul {list-style:none;}
#mid { font-size:0.9em;}
#received { float:right;}
address { font-style:inherit ;}
/*]]>*/
.quotelev1 {color : #990099}
.quotelev2 {color : #ff7700}
.quotelev3 {color : #007799}
.quotelev4 {color : #95c500}
</style>
</head>
<body>
<div class="head">
<h1>Re: [cc65] How to force a read from a memory mapped register w/o volatile</h1>
<!-- received="Tue Dec  7 15:02:04 2010" -->
<!-- isoreceived="20101207140204" -->
<!-- sent="Tue, 7 Dec 2010 15:01:55 +0100" -->
<!-- isosent="20101207140155" -->
<!-- name="Ullrich von Bassewitz" -->
<!-- email="uz1musoftware.de" -->
<!-- subject="Re: [cc65] How to force a read from a memory mapped register w/o volatile" -->
<!-- id="20101207140155.GB25083@trixie.musoftware.de" -->
<!-- charset="utf-8" -->
<!-- inreplyto="AANLkTi=JtW2G6B61uRLsFpZbVLb-c3aZMC8yun82EdSf&#64;mail.gmail.com" -->
<!-- expires="-1" -->
<map id="navbar" name="navbar">
<ul class="links">
<li>
<dfn>This message</dfn>:
[ <a href="#start" name="options1" id="options1" tabindex="1">Message body</a> ]
 [ <a href="#options2">More options</a> ]
</li>
<li>
<dfn>Related messages</dfn>:
<!-- unext="start" -->
[ <a href="9061.html" title="Groepaz: &quot;Re: [cc65] How to force a read from a memory mapped register w/o volatile&quot;">Next message</a> ]
[ <a href="9059.html" title="Dave Dribin: &quot;Re: [cc65] How to force a read from a memory mapped register w/o volatile&quot;">Previous message</a> ]
[ <a href="9059.html" title="Dave Dribin: &quot;Re: [cc65] How to force a read from a memory mapped register w/o volatile&quot;">In reply to</a> ]
<!-- unextthread="start" -->
 [ <a href="9061.html" title="Groepaz: &quot;Re: [cc65] How to force a read from a memory mapped register w/o volatile&quot;">Next in thread</a> ]
 [ <a href="#replies">Replies</a> ]
<!-- ureply="end" -->
</li>
</ul>
</map>
</div>
<!-- body="start" -->
<div class="mail">
<address class="headers">
<span id="from">
<dfn>From</dfn>: Ullrich von Bassewitz &lt;<a href="mailto:uz1musoftware.de?Subject=Re:%20[cc65]%20How%20to%20force%20a%20read%20from%20a%20memory%20mapped%20register%20w/o%20volatile">uz1musoftware.de</a>&gt;
</span><br />
<span id="date"><dfn>Date</dfn>: 2010-12-07 15:01:55</span><br />
</address>
<pre id="body">
<a name="start" accesskey="j" id="start"></a>On Mon, Dec 06, 2010 at 10:12:19PM -0600, Dave Dribin wrote:
&gt; Keep in mind I don't know anything about the optimizer, would it be
&gt; easier to optimize out a dummy variable?  i.e. is it difficult for the
&gt; optimizer to realize in this code that the pusha/incsp1 is
&gt; unnecessary?

In this special case it may be easy to detect. In the more general case, cc65
optimizations work on a too low level to detect such things easily.

&gt; But.... I think I have found a good work around.  Using inline
&gt; assembly + the 'bit' instruction seems to work.

It is a workaround, but not a good one. It works, because bit sets CPU flags
that the optimizer doesn't track, so it won't touch the instruction. This may
change in the future, so your code may stop working when compiled with
upcoming releases.

Regards


        Uz


-- 
Ullrich von Bassewitz                                  uz&#64;musoftware&#46;<!--nospam-->de
----------------------------------------------------------------------
To unsubscribe from the list send mail to majordomo&#64;musoftware&#46;<!--nospam-->de with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<span id="received"><dfn>Received on</dfn> Tue Dec  7 15:02:04 2010</span>
</div>
<!-- body="end" -->
<div class="foot">
<map id="navbarfoot" name="navbarfoot" title="Related messages">
<ul class="links">
<li><dfn>This message</dfn>: [ <a href="#start">Message body</a> ]</li>
<!-- lnext="start" -->
<li><dfn>Next message</dfn>: <a href="9061.html" title="Next message in the list">Groepaz: "Re: [cc65] How to force a read from a memory mapped register w/o volatile"</a></li>
<li><dfn>Previous message</dfn>: <a href="9059.html" title="Previous message in the list">Dave Dribin: "Re: [cc65] How to force a read from a memory mapped register w/o volatile"</a></li>
<li><dfn>In reply to</dfn>: <a href="9059.html" title="Message to which this message replies">Dave Dribin: "Re: [cc65] How to force a read from a memory mapped register w/o volatile"</a></li>
<!-- lnextthread="start" -->
<li><dfn>Next in thread</dfn>: <a href="9061.html" title="Next message in this discussion thread">Groepaz: "Re: [cc65] How to force a read from a memory mapped register w/o volatile"</a></li>
<li><a name="replies" id="replies"></a><dfn>Reply</dfn>:  <a href="9061.html" title="Message sent in reply to this message">Groepaz: "Re: [cc65] How to force a read from a memory mapped register w/o volatile"</a></li>
<!-- lreply="end" -->
</ul>
<ul class="links">
<li><a name="options2" id="options2"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="date.html#9060" title="Contemporary messages by date">By Date</a> ] [ <a href="index.html#9060" title="Contemporary discussion threads">By Thread</a> ] [ <a href="subject.html#9060" title="Contemporary messages by subject">By Subject</a> ]</ul>
</map>
</div>
<!-- trailer="footer" -->
<p><small><em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.8</a> 
: 2010-12-07 15:02:08 CET
</em></small></p>
</body>
</html>
