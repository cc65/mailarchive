<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="hypermail 2.1.8, see http://www.hypermail.org/" />
<title>cc65 mailing list archive: Re: [cc65] Macros in inline assembler</title>
<meta name="Author" content="Ullrich von Bassewitz (uz1musoftware.de)" />
<meta name="Subject" content="Re: [cc65] Macros in inline assembler" />
<meta name="Date" content="2012-01-19" />
<style type="text/css">
/*<![CDATA[*/
/* To be incorporated in the main stylesheet, don't code it in hypermail! */
body {color: black; background: #ffffff}
dfn {font-weight: bold;}
pre { background-color:inherit;}
.head { border-bottom:1px solid black;}
.foot { border-top:1px solid black;}
th {font-style:italic;}
table { margin-left:2em;}map ul {list-style:none;}
#mid { font-size:0.9em;}
#received { float:right;}
address { font-style:inherit ;}
/*]]>*/
.quotelev1 {color : #990099}
.quotelev2 {color : #ff7700}
.quotelev3 {color : #007799}
.quotelev4 {color : #95c500}
</style>
</head>
<body>
<div class="head">
<h1>Re: [cc65] Macros in inline assembler</h1>
<!-- received="Thu Jan 19 21:16:12 2012" -->
<!-- isoreceived="20120119201612" -->
<!-- sent="Thu, 19 Jan 2012 21:16:03 +0100" -->
<!-- isosent="20120119201603" -->
<!-- name="Ullrich von Bassewitz" -->
<!-- email="uz1musoftware.de" -->
<!-- subject="Re: [cc65] Macros in inline assembler" -->
<!-- id="20120119201603.GA21313@trixie.musoftware.de" -->
<!-- charset="utf-8" -->
<!-- inreplyto="CACT=u70gc1uHo0FSh=DAwdTu_6WfH4PwdgGgXx1YxG0SY2CgMg&#64;mail.gmail.com" -->
<!-- expires="-1" -->
<map id="navbar" name="navbar">
<ul class="links">
<li>
<dfn>This message</dfn>:
[ <a href="#start" name="options1" id="options1" tabindex="1">Message body</a> ]
 [ <a href="#options2">More options</a> ]
</li>
<li>
<dfn>Related messages</dfn>:
<!-- unext="start" -->
[ <a href="9917.html" title="Oliver Schmidt: &quot;[cc65] Preprocessor Issue (?)&quot;">Next message</a> ]
[ <a href="9915.html" title="Oliver Schmidt: &quot;Re: [cc65] Macros in inline assembler&quot;">Previous message</a> ]
[ <a href="9915.html" title="Oliver Schmidt: &quot;Re: [cc65] Macros in inline assembler&quot;">In reply to</a> ]
<!-- unextthread="start" -->
[ <a href="9906.html" title="Ullrich von Bassewitz: &quot;Re: [cc65] Macros in inline assembler&quot;">Next in thread</a> ]
<!-- ureply="end" -->
</li>
</ul>
</map>
</div>
<!-- body="start" -->
<div class="mail">
<address class="headers">
<span id="from">
<dfn>From</dfn>: Ullrich von Bassewitz &lt;<a href="mailto:uz1musoftware.de?Subject=Re:%20[cc65]%20Macros%20in%20inline%20assembler">uz1musoftware.de</a>&gt;
</span><br />
<span id="date"><dfn>Date</dfn>: 2012-01-19 21:16:03</span><br />
</address>
<pre id="body">
<a name="start" accesskey="j" id="start"></a>Hi!

On Thu, Jan 19, 2012 at 09:03:08PM +0100, Oliver Schmidt wrote:
&gt; Compiling the code below with -O has the line marked removed. I don't
&gt; see the code falling into one the two categories.

This is because rand() is an external function. For C functions, the following
rules hold true:

  * fastcall functions will use A/X on entry, all others will not
  * variadic functions will use Y on entry, all others will not.
  * All register contents are assumed to get destroyed, including zero page
    &quot;registers&quot; with the exception of the register bank.

Since rand() is not a variadic function, the compiler regards Y as destroyed
by the function, will therefore consider the load as useless and remove it.
You can of course argue that the current implementation of rand() will not
touch Y - but this is just luck. It can change at any time. So it is actually
the code that is more than doubtful. It may stop working from one day to the
next, even if the compiler would leave the load instruction intact.

Regards


        Uz


-- 
Ullrich von Bassewitz                                  uz&#64;musoftware&#46;<!--nospam-->de
----------------------------------------------------------------------
To unsubscribe from the list send mail to majordomo&#64;musoftware&#46;<!--nospam-->de with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<span id="received"><dfn>Received on</dfn> Thu Jan 19 21:16:12 2012</span>
</div>
<!-- body="end" -->
<div class="foot">
<map id="navbarfoot" name="navbarfoot" title="Related messages">
<ul class="links">
<li><dfn>This message</dfn>: [ <a href="#start">Message body</a> ]</li>
<!-- lnext="start" -->
<li><dfn>Next message</dfn>: <a href="9917.html" title="Next message in the list">Oliver Schmidt: "[cc65] Preprocessor Issue (?)"</a></li>
<li><dfn>Previous message</dfn>: <a href="9915.html" title="Previous message in the list">Oliver Schmidt: "Re: [cc65] Macros in inline assembler"</a></li>
<li><dfn>In reply to</dfn>: <a href="9915.html" title="Message to which this message replies">Oliver Schmidt: "Re: [cc65] Macros in inline assembler"</a></li>
<!-- lnextthread="start" -->
<li><dfn>Next in thread</dfn>: <a href="9906.html" title="Next message in this discussion thread">Ullrich von Bassewitz: "Re: [cc65] Macros in inline assembler"</a></li>
<!-- lreply="end" -->
</ul>
<ul class="links">
<li><a name="options2" id="options2"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="date.html#9916" title="Contemporary messages by date">By Date</a> ] [ <a href="index.html#9916" title="Contemporary discussion threads">By Thread</a> ] [ <a href="subject.html#9916" title="Contemporary messages by subject">By Subject</a> ]</ul>
</map>
</div>
<!-- trailer="footer" -->
<p><small><em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.8</a> 
: 2012-01-19 21:16:15 CET
</em></small></p>
</body>
</html>
