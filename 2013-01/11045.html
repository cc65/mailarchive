<?xml version="1.0" encoding="us-ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />
<meta name="generator" content="hypermail 2.1.8, see http://www.hypermail.org/" />
<title>cc65 mailing list archive: Re: Cursory analyses of CBM readdir b</title>
<meta name="Author" content="Spiro Trikaliotis (ml-cc651trikaliotis.net)" />
<meta name="Subject" content="Re: Cursory analyses of CBM readdir bug (was: [cc65] Re: readdir bug)" />
<meta name="Date" content="2013-01-04" />
<style type="text/css">
/*<![CDATA[*/
/* To be incorporated in the main stylesheet, don't code it in hypermail! */
body {color: black; background: #ffffff}
dfn {font-weight: bold;}
pre { background-color:inherit;}
.head { border-bottom:1px solid black;}
.foot { border-top:1px solid black;}
th {font-style:italic;}
table { margin-left:2em;}map ul {list-style:none;}
#mid { font-size:0.9em;}
#received { float:right;}
address { font-style:inherit ;}
/*]]>*/
.quotelev1 {color : #990099}
.quotelev2 {color : #ff7700}
.quotelev3 {color : #007799}
.quotelev4 {color : #95c500}
</style>
</head>
<body>
<div class="head">
<h1>Re: Cursory analyses of CBM readdir bug (was: [cc65] Re: readdir bug)</h1>
<!-- received="Fri Jan  4 13:22:21 2013" -->
<!-- isoreceived="20130104122221" -->
<!-- sent="Fri, 4 Jan 2013 13:21:57 +0100" -->
<!-- isosent="20130104122157" -->
<!-- name="Spiro Trikaliotis" -->
<!-- email="ml-cc651trikaliotis.net" -->
<!-- subject="Re: Cursory analyses of CBM readdir bug (was: [cc65] Re: readdir bug)" -->
<!-- id="20130104122157.GB21108@trikaliotis.net" -->
<!-- charset="us-ascii" -->
<!-- inreplyto="40640818-BB97-45AA-B8D6-6B3192EA5400&#64;wfmh.org.pl" -->
<!-- expires="-1" -->
<map id="navbar" name="navbar">
<ul class="links">
<li>
<dfn>This message</dfn>:
[ <a href="#start" name="options1" id="options1" tabindex="1">Message body</a> ]
 [ <a href="#options2">More options</a> ]
</li>
<li>
<dfn>Related messages</dfn>:
<!-- unext="start" -->
[ <a href="11046.html" title="Jeremy Turner: &quot;[cc65] ca65 bug? &quot;Range Error&quot; and scopes problem&quot;">Next message</a> ]
[ <a href="11044.html" title="silverdr1wfmh.org.pl: &quot;Re: Cursory analyses of CBM readdir bug (was: [cc65] Re: readdir bug)&quot;">Previous message</a> ]
[ <a href="11044.html" title="silverdr1wfmh.org.pl: &quot;Re: Cursory analyses of CBM readdir bug (was: [cc65] Re: readdir bug)&quot;">In reply to</a> ]
<!-- unextthread="start" -->
 [ <a href="11052.html" title="Greg King: &quot;Re: Cursory analyses of CBM readdir bug (was: [cc65] Re: readdir bug)&quot;">Next in thread</a> ]
<!-- ureply="end" -->
</li>
</ul>
</map>
</div>
<!-- body="start" -->
<div class="mail">
<address class="headers">
<span id="from">
<dfn>From</dfn>: Spiro Trikaliotis &lt;<a href="mailto:ml-cc651trikaliotis.net?Subject=Re:%20Cursory%20analyses%20of%20CBM%20readdir%20bug%20(was:%20[cc65]%20Re:%20readdir%20bug)">ml-cc651trikaliotis.net</a>&gt;
</span><br />
<span id="date"><dfn>Date</dfn>: 2013-01-04 13:21:57</span><br />
</address>
<pre id="body">
<a name="start" accesskey="j" id="start"></a>Hello,

* On Thu, Jan 03, 2013 at 11:27:45PM +0100 silverdr&#64;wfmh&#46;<!--nospam-->org.pl wrote:
&gt; 
&gt; On 2013-01-03, at 21:07, Spiro Trikaliotis wrote:

&gt; &gt; Here, the close is the problem. Closing the command/error channel is a special
&gt; &gt; case in the floppy, which interferes with your open file.
&gt; 
&gt; Which still qualifies as a bug to me, doesn't it to to you? :-)

Well, in a sense, probably. ;)

&gt; &gt; IIRC, closing the command channel results in closing all open channel in
&gt; &gt; the floppy (I would have to confirm it, but I am almost sure that this
&gt; &gt; was the case).
&gt; &gt; 
&gt; &gt; Thus, the solution: Never ever close the command channel.
&gt; 
&gt; I know the solution. Just it seems to be rather a workaround..

Indeed.

&gt; I am used to free resources as soon as I don't need them.

That's ok, but you are neglecting what is really happening in the C64
and the floppy.

The OPEN 2,8,15 is a no-op from the floppy's point of view. There is no
IEC traffic generated by it from the C64 side.

All it does is to set up some internal resource in the C64.

In fact, if anyone would do all the IEC traffic with the IEC routines,
not the CHRIN/CHROUT with CHKIN/CKOUT and the like, there would be no
need to close the channel at all.


In fact, I am unsure of what was really the intention of the CBM
engineers: Did the floppy programmers not take into account that the
error channel could be closed (as it does not make much sense from the
floppy's point of view: There is no need for opening it in the first
place), or what is a deliberate decision to close all files when the
error channel is closed - a &quot;reset all&quot; function. Or was there another
reason? I guess we will never know.

But you are absolutely right, this is something that should have been
documented. I was bitten by it myself, but I totally forgot about this
behaviour until you mentioned it.


&gt; Therefore I
&gt; didn't even suspect that closing one file (no matter what file it is)
&gt; may interfere with another but yes, now I know :-) Funny enough I
&gt; never encountered that bug before.

The error channel is not a file - like the dir, which is not a file, but
a special file. ;)

Regards,
Spiro.

-- 
Spiro R. Trikaliotis
<a href="http://www.trikaliotis.net/">http://www.trikaliotis.net/</a>
----------------------------------------------------------------------
To unsubscribe from the list send mail to majordomo&#64;musoftware&#46;<!--nospam-->de with
the string &quot;unsubscribe cc65&quot; in the body(!) of the mail.
</pre>
<span id="received"><dfn>Received on</dfn> Fri Jan  4 13:22:21 2013</span>
</div>
<!-- body="end" -->
<div class="foot">
<map id="navbarfoot" name="navbarfoot" title="Related messages">
<ul class="links">
<li><dfn>This message</dfn>: [ <a href="#start">Message body</a> ]</li>
<!-- lnext="start" -->
<li><dfn>Next message</dfn>: <a href="11046.html" title="Next message in the list">Jeremy Turner: "[cc65] ca65 bug? &quot;Range Error&quot; and scopes problem"</a></li>
<li><dfn>Previous message</dfn>: <a href="11044.html" title="Previous message in the list">silverdr1wfmh.org.pl: "Re: Cursory analyses of CBM readdir bug (was: [cc65] Re: readdir bug)"</a></li>
<li><dfn>In reply to</dfn>: <a href="11044.html" title="Message to which this message replies">silverdr1wfmh.org.pl: "Re: Cursory analyses of CBM readdir bug (was: [cc65] Re: readdir bug)"</a></li>
<!-- lnextthread="start" -->
<li><dfn>Next in thread</dfn>: <a href="11052.html" title="Next message in this discussion thread">Greg King: "Re: Cursory analyses of CBM readdir bug (was: [cc65] Re: readdir bug)"</a></li>
<!-- lreply="end" -->
</ul>
<ul class="links">
<li><a name="options2" id="options2"></a><dfn>Contemporary messages sorted</dfn>: [ <a href="date.html#11045" title="Contemporary messages by date">By Date</a> ] [ <a href="index.html#11045" title="Contemporary discussion threads">By Thread</a> ] [ <a href="subject.html#11045" title="Contemporary messages by subject">By Subject</a> ]</ul>
</map>
</div>
<!-- trailer="footer" -->
<p><small><em>
This archive was generated by <a href="http://www.hypermail.org/">hypermail 2.1.8</a> 
: 2013-01-04 13:22:26 CET
</em></small></p>
</body>
</html>
